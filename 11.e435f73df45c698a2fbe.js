(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"5cWN":function(t,e,n){"use strict";n.r(e),n.d(e,"CategoriesModule",function(){return Rp});var r=n("ofXK"),i=n("s7LF"),o=n("tyNb"),s=n("fXoL");let a=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Cb({type:t,selectors:[["app-categories"]],decls:1,vars:0,template:function(t,e){1&t&&s.Jb(0,"router-outlet")},directives:[o.e],styles:[""]}),t})(),u=(()=>{class t{constructor(){this.collections={categories_table:"categories",users_table:"users"}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var c=n("D0XW"),h=n("HDdC"),l=n("Cfvw"),f=n("LRne"),d=n("JX91"),p=n("7o/Q");function g(){return t=>t.lift(new y)}class y{call(t,e){return e.subscribe(new v(t))}}class v extends p.a{constructor(t){super(t),this.hasPrev=!1}_next(t){let e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}var m=n("lJxs"),b=n("Kqap");class w{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new O(t,this.compare,this.keySelector))}}class O extends p.a{constructor(t,e,n){super(t),this.keySelector=n,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e;try{const{keySelector:n}=this;e=n?n(t):t}catch(r){return this.destination.error(r)}let n=!1;if(this.hasKey)try{const{compare:t}=this;n=t(this.key,e)}catch(r){return this.destination.error(r)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))}}var _=n("pLZG"),I=n("pxpQ"),T=n("spgP"),E=n("Jgta"),S=n("zIRd"),C=n("qOnz"),x=n("q/0M"),P=function(t,e){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function N(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var A,D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},k=k||{},j=D||self;function M(){}function R(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var F="closure_uid_"+(1e9*Math.random()>>>0),U=0;function q(t,e,n){return t.call.apply(t.bind,arguments)}function V(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function B(t,e,n){return(B=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?q:V).apply(null,arguments)}function K(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function G(){return Date.now()}function z(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function Q(){this.j=this.j,this.i=this.i}Q.prototype.j=!1,Q.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,F)&&t[F]||(t[F]=++U)}(this)},Q.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var W=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},H=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Y(t){return Array.prototype.concat.apply([],arguments)}function X(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function J(t){return/^[\s\xa0]*$/.test(t)}var $,Z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function tt(t,e){return-1!=t.indexOf(e)}function et(t,e){return t<e?-1:t>e?1:0}t:{var nt=j.navigator;if(nt){var rt=nt.userAgent;if(rt){$=rt;break t}}$=""}function it(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function ot(t){var e={};for(var n in t)e[n]=t[n];return e}var st="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function at(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<st.length;o++)n=st[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ut(t){return ut[" "](t),t}ut[" "]=M;var ct,ht,lt=tt($,"Opera"),ft=tt($,"Trident")||tt($,"MSIE"),dt=tt($,"Edge"),pt=dt||ft,gt=tt($,"Gecko")&&!(tt($.toLowerCase(),"webkit")&&!tt($,"Edge"))&&!(tt($,"Trident")||tt($,"MSIE"))&&!tt($,"Edge"),yt=tt($.toLowerCase(),"webkit")&&!tt($,"Edge");function vt(){var t=j.document;return t?t.documentMode:void 0}t:{var mt="",bt=(ht=$,gt?/rv:([^\);]+)(\)|;)/.exec(ht):dt?/Edge\/([\d\.]+)/.exec(ht):ft?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ht):yt?/WebKit\/(\S+)/.exec(ht):lt?/(?:Version)[ \/]?(\S+)/.exec(ht):void 0);if(bt&&(mt=bt?bt[1]:""),ft){var wt=vt();if(null!=wt&&wt>parseFloat(mt)){ct=String(wt);break t}}ct=mt}var Ot={};function _t(t){return function(t,e){var n=Ot;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=Z(String(ct)).split("."),r=Z(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=et(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||et(0==s[2].length,0==a[2].length)||et(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var It=j.document&&ft&&(vt()||parseInt(ct,10))||void 0,Tt=!ft||9<=Number(It),Et=ft&&!_t("9"),St=function(){if(!j.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{j.addEventListener("test",M,e),j.removeEventListener("test",M,e)}catch(n){}return t}();function Ct(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function xt(t,e){if(Ct.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(gt){t:{try{ut(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Pt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}Ct.prototype.b=function(){this.defaultPrevented=!0},z(xt,Ct);var Pt={2:"touch",3:"pen",4:"mouse"};xt.prototype.b=function(){xt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Et)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var Nt="closure_listenable_"+(1e6*Math.random()|0),At=0;function Dt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++At,this.Y=this.Z=!1}function kt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function jt(t){this.src=t,this.a={},this.b=0}function Mt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=W(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(kt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Rt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}jt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Rt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Dt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Lt="closure_lm_"+(1e6*Math.random()|0),Ft={};function Ut(t,e,n,r,i){if(r&&r.once)return Vt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ut(t,e[o],n,r,i);return null}return n=Yt(n),t&&t[Nt]?t.va(e,n,L(r)?!!r.capture:!!r,i):qt(t,e,n,!1,r,i)}function qt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=L(i)?!!i.capture:!!i;if(s&&!Tt)return null;var a=Wt(t);if(a||(t[Lt]=a=new jt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Qt,e=Tt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)St||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Gt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Vt(t,e[o],n,r,i);return null}return n=Yt(n),t&&t[Nt]?t.wa(e,n,L(r)?!!r.capture:!!r,i):qt(t,e,n,!0,r,i)}function Bt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Bt(t,e[o],n,r,i);else r=L(r)?!!r.capture:!!r,n=Yt(n),t&&t[Nt]?(t=t.c,(e=String(e).toString())in t.a&&-1<(n=Rt(o=t.a[e],n,r,i))&&(kt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=Wt(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Rt(e,n,r,i)),(n=-1<t?e[t]:null)&&Kt(n))}function Kt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Nt])Mt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Gt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Wt(e))?(Mt(n,t),0==n.b&&(n.src=null,e[Lt]=null)):kt(t)}}}function Gt(t){return t in Ft?Ft[t]:Ft[t]="on"+t}function zt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Kt(t),n.call(r,e)}function Qt(t,e){if(t.Y)return!0;if(!Tt){if(!e)t:{e=["window","event"];for(var n=j,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return zt(t,e=new xt(e,this))}return zt(t,new xt(e,this))}function Wt(t){return(t=t[Lt])instanceof jt?t:null}var Ht="__closure_events_fn_"+(1e9*Math.random()>>>0);function Yt(t){return"function"==typeof t?t:(t[Ht]||(t[Ht]=function(e){return t.handleEvent(e)}),t[Ht])}function Xt(){Q.call(this),this.c=new jt(this),this.J=this,this.C=null}function Jt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new Ct(e,t);else if(e instanceof Ct)e.target=e.target||t;else{var i=e;at(e=new Ct(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=$t(s,r,!0,e)&&i}if(i=$t(s=e.a=t,r,!0,e)&&i,i=$t(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=$t(s=e.a=n[o],r,!1,e)&&i}function $t(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&Mt(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}z(Xt,Q),Xt.prototype[Nt]=!0,(A=Xt.prototype).addEventListener=function(t,e,n,r){Ut(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){Bt(this,t,e,n,r)},A.G=function(){if(Xt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)kt(n[r]);delete e.a[t],e.b--}}this.C=null},A.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},A.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Zt=j.JSON.stringify;function te(){this.b=this.a=null}var ee,ne=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,this.a=(t=this.a).next,t.next=null):t=this.c(),t},t}())(function(){return new ie},function(t){t.reset()});function re(){var t=ue,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function ie(){this.next=this.b=this.a=null}function oe(t){j.setTimeout(function(){throw t},0)}function se(t,e){ee||function(){var t=j.Promise.resolve(void 0);ee=function(){t.then(ce)}}(),ae||(ee(),ae=!0),ue.add(t,e)}te.prototype.add=function(t,e){var n=ne.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},ie.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},ie.prototype.reset=function(){this.next=this.b=this.a=null};var ae=!1,ue=new te;function ce(){for(var t;t=re();){try{t.a.call(t.b)}catch(n){oe(n)}var e=ne;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}ae=!1}function he(t,e){Xt.call(this),this.b=t||1,this.a=e||j,this.f=B(this.Za,this),this.g=G()}function le(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function fe(t,e,n){if("function"==typeof t)n&&(t=B(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=B(t.handleEvent,t)}return 2147483647<Number(e)?-1:j.setTimeout(t,e||0)}function de(t){t.a=fe(function(){t.a=null,t.c&&(t.c=!1,de(t))},t.h);var e=t.b;t.b=null,t.g.apply(null,e)}z(he,Xt),(A=he.prototype).aa=!1,A.M=null,A.Za=function(){if(this.aa){var t=G()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Jt(this,"tick"),this.aa&&(le(this),this.start()))}},A.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=G())},A.G=function(){he.X.G.call(this),le(this),delete this.a};var pe=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:de(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(j.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(Q);function ge(t){Q.call(this),this.b=t,this.a={}}z(ge,Q);var ye=[];function ve(t,e,n,r){Array.isArray(n)||(n&&(ye[0]=n.toString()),n=ye);for(var i=0;i<n.length;i++){var o=Ut(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function me(t){it(t.a,function(t,e){this.a.hasOwnProperty(e)&&Kt(t)},t),t.a={}}function be(){this.a=!0}function we(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Zt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}ge.prototype.G=function(){ge.X.G.call(this),me(this)},ge.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},be.prototype.info=function(){};var Oe={},_e=null;function Ie(){return _e=_e||new Xt}function Te(t){Ct.call(this,Oe.Fa,t)}function Ee(t){var e=Ie();Jt(e,new Te(e,t))}function Se(t,e){Ct.call(this,Oe.STAT_EVENT,t),this.stat=e}function Ce(t){var e=Ie();Jt(e,new Se(e,t))}function xe(t){Ct.call(this,Oe.Ga,t)}function Pe(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return j.setTimeout(function(){t()},e)}Oe.Fa="serverreachability",z(Te,Ct),Oe.STAT_EVENT="statevent",z(Se,Ct),Oe.Ga="timingevent",z(xe,Ct);var Ne={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Ae={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function De(){}function ke(){}De.prototype.a=null;var je,Me={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Re(){Ct.call(this,"d")}function Le(){Ct.call(this,"c")}function Fe(){}function Ue(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ge(this),this.P=qe,this.R=new he(t=pt?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}z(Re,Ct),z(Le,Ct),z(Fe,De),je=new Fe;var qe=45e3,Ve={},Be={};function Ke(t,e,n){t.H=1,t.i=fn(sn(e)),t.j=n,t.I=!0,Ge(t,null)}function Ge(t,e){t.u=G(),We(t),t.l=sn(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),En(n.b,"t",r),t.D=0,t.a=br(t.g,t.g.C?e:null),0<t.O&&(t.F=new pe(B(t.Ca,t,t.a),t.O)),ve(t.J,t.a,"readystatechange",t.Xa),e=t.B?ot(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),Ee(1),function(t,e,n,r,i,o){t.info(function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.c,t.m,t.l,t.f,t.S,t.j)}function ze(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Qe(t,n);if(i==Be){4==e&&(t.h=4,Ce(14),r=!1),we(t.c,t.f,null,"[Incomplete Response]");break}if(i==Ve){t.h=4,Ce(15),we(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}we(t.c,t.f,i,null),$e(t,i)}4==e&&0==n.length&&(t.h=1,Ce(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),lr(e),e.F=!0,Ce(11))):(we(t.c,t.f,n,"[Invalid Chunked Response]"),Je(t),Xe(t))}function Qe(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Be:(n=Number(e.substring(n,r)),isNaN(n)?Ve:(r+=1)+n>e.length?Be:(e=e.substr(r,n),t.D=r+n,e))}function We(t){t.T=G()+t.P,He(t,t.P)}function He(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Pe(B(t.Va,t),e)}function Ye(t){t.o&&(j.clearTimeout(t.o),t.o=null)}function Xe(t){0==t.g.v||t.A||pr(t.g,t)}function Je(t){Ye(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,le(t.R),me(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function $e(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||Dn(n.b,t)))if(n.I=t.N,!t.C&&Dn(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(nd){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;dr(n),nr(n)}hr(n),Ce(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=Pe(B(n.Sa,n),6e3));if(1>=An(n.b)&&n.ea){try{n.ea()}catch(nd){}n.ea=void 0}}else yr(n,11)}else if((t.C||n.a==t)&&dr(n),!J(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(n.P=(i=e[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(tt(h,"spdy")||tt(h,"quic")||tt(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(kn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,ln(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=G()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=mr(u,u.C?u.ga:null,u.fa),d.C){jn(u.b,d);var p=d,g=u.D;g&&p.setTimeout(g),p.o&&(Ye(p),We(p)),u.a=d}else cr(u);0<n.g.length&&or(n)}else"stop"!=i[0]&&"close"!=i[0]||yr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?yr(n,7):er(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);Ee(4)}catch(nd){}}function Ze(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(R(t)||"string"==typeof t)H(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(R(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(R(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function tn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof tn)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function en(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];nn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)nn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function nn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(A=Ue.prototype).setTimeout=function(t){this.P=t},A.Xa=function(t){t=t.target;var e=this.F;e&&3==Jn(t)?e.f():this.Ca(t)},A.Ca=function(t){try{if(t==this.a)t:{var e=Jn(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!pt&&!this.a.$())){this.A||4!=e||7==n||Ee(8==n||0>=r?3:2),Ye(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!J(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,Ce(12),Je(this),Xe(this);break t}we(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,$e(this,u)}this.I?(ze(this,e,o),pt&&this.b&&3==e&&(ve(this.J,this.R,"tick",this.Wa),this.R.start())):(we(this.c,this.f,o,null),$e(this,o)),4==e&&Je(this),this.b&&!this.A&&(4==e?pr(this.g,this):(this.b=!1,We(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,Ce(12)):(this.h=0,Ce(13)),Je(this),Xe(this)}}}catch(c){}},A.Wa=function(){if(this.a){var t=Jn(this.a),e=this.a.$();this.D<e.length&&(Ye(this),ze(this,t,e),this.b&&4!=t&&We(this))}},A.cancel=function(){this.A=!0,Je(this)},A.Va=function(){this.o=null;var t=G();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(Ee(3),Ce(17)),Je(this),this.h=2,Xe(this)):He(this,this.T-t)},(A=tn.prototype).K=function(){en(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},A.L=function(){return en(this),this.a.concat()},A.get=function(t,e){return nn(this.b,t)?this.b[t]:e},A.set=function(t,e){nn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},A.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var rn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function on(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof on){this.a=void 0!==e?e:t.a,an(this,t.f),this.j=t.j,un(this,t.c),cn(this,t.h),this.g=t.g,e=t.b;var n=new On;n.c=e.c,e.a&&(n.a=new tn(e.a),n.b=e.b),hn(this,n),this.i=t.i}else t&&(n=String(t).match(rn))?(this.a=!!e,an(this,n[1]||"",!0),this.j=dn(n[2]||""),un(this,n[3]||"",!0),cn(this,n[4]),this.g=dn(n[5]||"",!0),hn(this,n[6]||"",!0),this.i=dn(n[7]||"")):(this.a=!!e,this.b=new On(null,this.a))}function sn(t){return new on(t)}function an(t,e,n){t.f=n?dn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function un(t,e,n){t.c=n?dn(e,!0):e}function cn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function hn(t,e,n){e instanceof On?(t.b=e,function(t,e){e&&!t.f&&(_n(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(In(this,e),En(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=pn(e,bn)),t.b=new On(e,t.a))}function ln(t,e,n){t.b.set(e,n)}function fn(t){return ln(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^G()).toString(36)),t}function dn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function pn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,gn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function gn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}on.prototype.toString=function(){var t=[],e=this.f;e&&t.push(pn(e,yn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(pn(e,yn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(pn(n,"/"==n.charAt(0)?mn:vn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",pn(n,wn)),t.join("")};var yn=/[#\/\?@]/g,vn=/[#\?:]/g,mn=/[#\?]/g,bn=/[#\?@]/g,wn=/#/g;function On(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function _n(t){t.a||(t.a=new tn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function In(t,e){_n(t),e=Sn(t,e),nn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,nn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&en(t)))}function Tn(t,e){return _n(t),e=Sn(t,e),nn(t.a.b,e)}function En(t,e,n){In(t,e),0<n.length&&(t.c=null,t.a.set(Sn(t,e),X(n)),t.b+=n.length)}function Sn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(A=On.prototype).add=function(t,e){_n(this),this.c=null,t=Sn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},A.forEach=function(t,e){_n(this),this.a.forEach(function(n,r){H(n,function(n){t.call(e,n,r,this)},this)},this)},A.L=function(){_n(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},A.K=function(t){_n(this);var e=[];if("string"==typeof t)Tn(this,t)&&(e=Y(e,this.a.get(Sn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=Y(e,t[n])}return e},A.set=function(t,e){return _n(this),this.c=null,Tn(this,t=Sn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},A.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},A.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var Cn=function(){return function(t,e){this.b=t,this.a=e}}();function xn(t){this.g=t||Pn,t=j.PerformanceNavigationTiming?0<(t=j.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(j.ia&&j.ia.ya&&j.ia.ya()&&j.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Pn=10;function Nn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function An(t){return t.b?1:t.a?t.a.size:0}function Dn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function kn(t,e){t.a?t.a.add(e):t.b=e}function jn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Mn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=N(t.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return X(t.c)}function Rn(){}function Ln(){this.a=new Rn}function Fn(t,e,n){var r=n||"";try{Ze(t,function(t,n){var i=t;L(t)&&(i=Zt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(Ud){throw e.push(r+"type="+encodeURIComponent("_badmap")),Ud}}function Un(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}xn.prototype.cancel=function(){var t,e;if(this.c=Mn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=N(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Rn.prototype.stringify=function(t){return j.JSON.stringify(t,void 0)},Rn.prototype.parse=function(t){return j.JSON.parse(t,void 0)};var qn=j.JSON.parse;function Vn(t){Xt.call(this),this.headers=new tn,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Bn,this.D=this.F=!1}z(Vn,Xt);var Bn="",Kn=/^https?$/i,Gn=["POST","PUT"];function zn(t){return"content-type"==t.toLowerCase()}function Qn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Wn(t),Yn(t)}function Wn(t){t.u||(t.u=!0,Jt(t,"complete"),Jt(t,"error"))}function Hn(t){if(t.b&&void 0!==k&&(!t.s[1]||4!=Jn(t)||2!=t.W()))if(t.l&&4==Jn(t))fe(t.za,0,t);else if(Jt(t,"readystatechange"),4==Jn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(rn)[1]||null;if(!o&&j.self&&j.self.location){var s=j.self.location.protocol;o=s.substr(0,s.length-1)}i=!Kn.test(o?o.toLowerCase():"")}e=i}if(e)Jt(t,"complete"),Jt(t,"success");else{t.h=6;try{var a=2<Jn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",Wn(t)}}finally{Yn(t)}}}function Yn(t,e){if(t.a){Xn(t);var n=t.a,r=t.s[0]?M:null;t.a=null,t.s=null,e||Jt(t,"ready");try{n.onreadystatechange=r}catch(Ud){}}}function Xn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(j.clearTimeout(t.m),t.m=null)}function Jn(t){return t.a?t.a.readyState:0}function $n(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return it(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):ln(t,e,n))}function Zn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function tr(t){this.pa=0,this.g=[],this.c=new be,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Zn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Zn("baseRetryDelayMs",5e3,t),this.Ra=Zn("retryDelaySeedMs",1e4,t),this.Ma=Zn("forwardChannelMaxRetries",2,t),this.ma=Zn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new xn(t&&t.concurrentRequestLimit),this.ka=new Ln,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function er(t){if(rr(t),3==t.v){var e=t.R++,n=sn(t.B);ln(n,"SID",t.J),ln(n,"RID",e),ln(n,"TYPE","terminate"),ar(t,n),(e=new Ue(t,t.c,e,void 0)).H=2,e.i=fn(sn(n)),n=!1,j.navigator&&j.navigator.sendBeacon&&(n=j.navigator.sendBeacon(e.i.toString(),"")),!n&&j.Image&&((new Image).src=e.i,n=!0),n||(e.a=br(e.g,null),e.a.ba(e.i)),e.u=G(),We(e)}vr(t)}function nr(t){t.a&&(lr(t),t.a.cancel(),t.a=null)}function rr(t){nr(t),t.j&&(j.clearTimeout(t.j),t.j=null),dr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&j.clearTimeout(t.h),t.h=null)}function ir(t,e){t.g.push(new Cn(t.Oa++,e)),3==t.v&&or(t)}function or(t){Nn(t.b)||t.h||(t.h=!0,se(t.Ba,t),t.u=0)}function sr(t,e){var n;n=e?e.f:t.R++;var r=sn(t.B);ln(r,"SID",t.J),ln(r,"RID",n),ln(r,"AID",t.P),ar(t,r),t.i&&t.l&&$n(r,t.i,t.l),n=new Ue(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=ur(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),kn(t.b,n),Ke(n,r,e)}function ar(t,e){t.f&&Ze({},function(t,n){ln(e,n,t)})}function ur(t,e,n){n=Math.min(t.g.length,n);var r=t.f?B(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{Fn(h,s,"req"+c+"_")}catch(Xr){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function cr(t){t.a||t.j||(t.T=1,se(t.Aa,t),t.o=0)}function hr(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=Pe(B(t.Aa,t),gr(t,t.o)),t.o++,0))}function lr(t){null!=t.s&&(j.clearTimeout(t.s),t.s=null)}function fr(t){t.a=new Ue(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=sn(t.la);ln(e,"RID","rpc"),ln(e,"SID",t.J),ln(e,"CI",t.H?"0":"1"),ln(e,"AID",t.P),ar(t,e),ln(e,"TYPE","xmlhttp"),t.i&&t.l&&$n(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=fn(sn(e)),n.j=null,n.I=!0,Ge(n,t)}function dr(t){null!=t.m&&(j.clearTimeout(t.m),t.m=null)}function pr(t,e){var n=null;if(t.a==e){dr(t),lr(t),t.a=null;var r=2}else{if(!Dn(t.b,e))return;n=e.s,jn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=G()-e.u;var i=t.u;Jt(r=Ie(),new xe(r,n,e,i)),or(t)}else cr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(An(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=Pe(B(t.Ba,t,e),gr(t,t.u)),t.u++,0)))}(t,e)||2==r&&hr(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:yr(t,5);break;case 4:yr(t,10);break;case 3:yr(t,6);break;default:yr(t,2)}}function gr(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function yr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=B(t.Ya,t);n||(n=new on("//www.google.com/images/cleardot.gif"),j.location&&"http"==j.location.protocol||an(n,"https"),fn(n)),function(t,e){var n=new be;if(j.Image){var r=new Image;r.onload=K(Un,n,r,"TestLoadImage: loaded",!0,e),r.onerror=K(Un,n,r,"TestLoadImage: error",!1,e),r.onabort=K(Un,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=K(Un,n,r,"TestLoadImage: timeout",!1,e),j.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else Ce(2);t.v=0,t.f&&t.f.ra(e),vr(t),rr(t)}function vr(t){t.v=0,t.I=-1,t.f&&(0==Mn(t.b).length&&0==t.g.length||(t.b.c.length=0,X(t.g),t.g.length=0),t.f.qa())}function mr(t,e,n){var r=function(t){return t instanceof on?sn(t):new on(t,void 0)}(n);if(""!=r.c)e&&un(r,e+"."+r.c),cn(r,r.h);else{var i=j.location;r=function(t,e,n,r){var i=new on(null,void 0);return t&&an(i,t),e&&un(i,e),n&&cn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&it(t.V,function(t,e){ln(r,e,t)}),n=t.na,(e=t.A)&&n&&ln(r,e,n),ln(r,"VER",t.ha),ar(t,r),r}function br(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Vn(t.Na)).F=t.C,e}function wr(){}function Or(){if(ft&&!(10<=Number(It)))throw Error("Environmental error: no available transport.")}function _r(t,e){Xt.call(this),this.a=new tr(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!J(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!J(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new Er(this)}function Ir(t){Re.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Tr(){Le.call(this),this.status=1}function Er(t){this.a=t}(A=Vn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(t){var e;return(e=t.a)||(e=t.a={}),e}(this.H?this.H:je),this.a.onreadystatechange=B(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void Qn(this,o)}t=n||"";var i=new tn(this.headers);r&&Ze(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=zn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=j.FormData&&t instanceof j.FormData,!(0<=W(Gn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Xn(this),0<this.o&&((this.D=function(t){return ft&&_t(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=B(this.xa,this)):this.m=fe(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){Qn(this,o)}},A.xa=function(){void 0!==k&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Jt(this,"timeout"),this.abort(8))},A.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Jt(this,"complete"),Jt(this,"abort"),Yn(this))},A.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Yn(this,!0)),Vn.X.G.call(this)},A.za=function(){this.j||(this.A||this.l||this.g?Hn(this):this.Ua())},A.Ua=function(){Hn(this)},A.W=function(){try{return 2<Jn(this)?this.a.status:-1}catch(ht){return-1}},A.$=function(){try{return this.a?this.a.responseText:""}catch(ht){return""}},A.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),qn(e)}},A.ua=function(){return this.h},A.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(A=tr.prototype).ha=8,A.v=1,A.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ue(this,this.c,t,void 0),r=this.l;if(this.O&&(r?at(r=ot(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=ur(this,n,e),ln(i=sn(this.B),"RID",t),ln(i,"CVER",22),this.A&&ln(i,"X-HTTP-Session-Id",this.A),ar(this,i),this.i&&r&&$n(i,this.i,r),kn(this.b,n),this.Ia&&ln(i,"TYPE","init"),this.da?(ln(i,"$req",e),ln(i,"SID","null"),n.U=!0,Ke(n,i,null)):Ke(n,i,e),this.v=2}}else 3==this.v&&(t?sr(this,t):0==this.g.length||Nn(this.b)||sr(this))},A.Aa=function(){if(this.j=null,fr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=Pe(B(this.Ta,this),t)}},A.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Ce(10),nr(this),fr(this))},A.Sa=function(){null!=this.m&&(this.m=null,nr(this),hr(this),Ce(19))},A.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),Ce(2)):(this.c.info("Failed to ping google.com"),Ce(1))},(A=wr.prototype).ta=function(){},A.sa=function(){},A.ra=function(){},A.qa=function(){},A.Ja=function(){},Or.prototype.a=function(t,e){return new _r(t,e)},z(_r,Xt),_r.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;Ce(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=mr(t,null,t.fa),or(t)},_r.prototype.close=function(){er(this.a)},_r.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,ir(this.a,e)}else this.l?((e={}).__data__=Zt(t),ir(this.a,e)):ir(this.a,t)},_r.prototype.G=function(){this.a.f=null,delete this.f,er(this.a),delete this.a,_r.X.G.call(this)},z(Ir,Re),z(Tr,Le),z(Er,wr),Er.prototype.ta=function(){Jt(this.a,"a")},Er.prototype.sa=function(t){Jt(this.a,new Ir(t))},Er.prototype.ra=function(t){Jt(this.a,new Tr(t))},Er.prototype.qa=function(){Jt(this.a,"b")},Or.prototype.createWebChannel=Or.prototype.a,_r.prototype.send=_r.prototype.h,_r.prototype.open=_r.prototype.g,_r.prototype.close=_r.prototype.close,Ne.NO_ERROR=0,Ne.TIMEOUT=8,Ne.HTTP_ERROR=6,Ae.COMPLETE="complete",ke.EventType=Me,Me.OPEN="a",Me.CLOSE="b",Me.ERROR="c",Me.MESSAGE="d",Xt.prototype.listen=Xt.prototype.va,Vn.prototype.listenOnce=Vn.prototype.wa,Vn.prototype.getLastError=Vn.prototype.Qa,Vn.prototype.getLastErrorCode=Vn.prototype.ua,Vn.prototype.getStatus=Vn.prototype.W,Vn.prototype.getResponseJson=Vn.prototype.Pa,Vn.prototype.getResponseText=Vn.prototype.$,Vn.prototype.send=Vn.prototype.ba;var Sr=Ne,Cr=Ae,xr=Oe,Pr=ke,Nr=Vn,Ar=n("mrSG"),Dr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Dr.o=-1;var kr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},jr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(Ar.c)(e,t),e}(Error),Mr=new x.b("@firebase/firestore");function Rr(){return Mr.logLevel}function Lr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Mr.logLevel<=x.a.DEBUG){var r=e.map(qr);Mr.debug.apply(Mr,Object(Ar.f)(["Firestore (8.6.2): "+t],r))}}function Fr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Mr.logLevel<=x.a.ERROR){var r=e.map(qr);Mr.error.apply(Mr,Object(Ar.f)(["Firestore (8.6.2): "+t],r))}}function Ur(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Mr.logLevel<=x.a.WARN){var r=e.map(qr);Mr.warn.apply(Mr,Object(Ar.f)(["Firestore (8.6.2): "+t],r))}}function qr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Ud){return t}}function Vr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.6.2) INTERNAL ASSERTION FAILED: "+t;throw Fr(e),new Error(e)}function Br(t,e){t||Vr()}function Kr(t,e){return t}function Gr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var zr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Gr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Qr(t,e){return t<e?-1:t>e?1:0}function Wr(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function Hr(t){return t+"\0"}var Yr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new jr(kr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new jr(kr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new jr(kr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new jr(kr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Qr(this.nanoseconds,t.nanoseconds):Qr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Xr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Yr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Jr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function $r(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Zr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var ti=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Vr(),void 0===n?n=t.length-e:n>t.length-e&&Vr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ei=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Ar.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new jr(kr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(ti),ni=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ri=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Ar.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return ni.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new jr(kr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new jr(kr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new jr(kr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new jr(kr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(ti),ii=function(){function t(t){this.fields=t,t.sort(ri.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Wr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),oi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Qr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();oi.EMPTY_BYTE_STRING=new oi("");var si=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ai(t){if(Br(!!t),"string"==typeof t){var e=0,n=si.exec(t);if(Br(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ui(t.seconds),nanos:ui(t.nanos)}}function ui(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ci(t){return"string"==typeof t?oi.fromBase64String(t):oi.fromUint8Array(t)}function hi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function li(t){var e=t.mapValue.fields.__previous_value__;return hi(e)?li(e):e}function fi(t){var e=ai(t.mapValue.fields.__local_write_time__.timestampValue);return new Yr(e.seconds,e.nanos)}function di(t){return null==t}function pi(t){return 0===t&&1/t==-1/0}function gi(t){return"number"==typeof t&&Number.isInteger(t)&&!pi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var yi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(ei.fromString(e))},t.fromName=function(e){return new t(ei.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ei.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return ei.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new ei(e.slice()))},t}();function vi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?hi(t)?4:10:Vr()}function mi(t,e){var n=vi(t);if(n!==vi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return fi(t).isEqual(fi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=ai(t.timestampValue),r=ai(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ci(t.bytesValue).isEqual(ci(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ui(t.geoPointValue.latitude)===ui(e.geoPointValue.latitude)&&ui(t.geoPointValue.longitude)===ui(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ui(t.integerValue)===ui(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ui(t.doubleValue),r=ui(e.doubleValue);return n===r?pi(n)===pi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Wr(t.arrayValue.values||[],e.arrayValue.values||[],mi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Jr(n)!==Jr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!mi(n[i],r[i])))return!1;return!0}(t,e);default:return Vr()}}function bi(t,e){return void 0!==(t.values||[]).find(function(t){return mi(t,e)})}function wi(t,e){var n=vi(t),r=vi(e);if(n!==r)return Qr(n,r);switch(n){case 0:return 0;case 1:return Qr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=ui(t.integerValue||t.doubleValue),r=ui(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Oi(t.timestampValue,e.timestampValue);case 4:return Oi(fi(t),fi(e));case 5:return Qr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ci(t),r=ci(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Qr(n[i],r[i]);if(0!==o)return o}return Qr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Qr(ui(t.latitude),ui(e.latitude));return 0!==n?n:Qr(ui(t.longitude),ui(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=wi(n[i],r[i]);if(o)return o}return Qr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Qr(r[s],o[s]);if(0!==a)return a;var u=wi(n[r[s]],i[o[s]]);if(0!==u)return u}return Qr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Vr()}}function Oi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Qr(t,e);var n=ai(t),r=ai(e),i=Qr(n.seconds,r.seconds);return 0!==i?i:Qr(n.nanos,r.nanos)}function _i(t){return Ii(t)}function Ii(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=ai(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ci(t.bytesValue).toBase64():"referenceValue"in t?yi.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Ii(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Ii(t.fields[o])}return e+"}"}(t.mapValue):Vr();var e}function Ti(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ei(t){return!!t&&"integerValue"in t}function Si(t){return!!t&&"arrayValue"in t}function Ci(t){return!!t&&"nullValue"in t}function xi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Pi(t){return!!t&&"mapValue"in t}var Ni=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(ri.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach(function(t,n){t?e.set(n,t):e.delete(n)})},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return mi(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===vi(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=Pi(o)?Object.assign({},o.mapValue.fields):{};return n.forEach(function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)}),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(ri.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!Pi(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function Ai(t){var e=[];return $r(t.fields||{},function(t,n){var r=new ri([t]);if(Pi(n)){var i=Ai(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new ii(e)}var Di=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Xr.min(),Ni.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Ni.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Ni.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ni.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ni.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),ki=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function ji(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new ki(t,e,n,r,i,o,s)}function Mi(t){var e=Kr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+_i(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),di(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Hi(e.startAt)),e.endAt&&(n+="|ub:",n+=Hi(e.endAt)),e.h=n}return e.h}function Ri(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Xi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!mi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!$i(t.startAt,e.startAt)&&$i(t.endAt,e.endAt)}function Li(t){return yi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Fi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(Ar.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Ui(t,n,r):"array-contains"===n?new Ki(t,r):"in"===n?new Gi(t,r):"not-in"===n?new zi(t,r):"array-contains-any"===n?new Qi(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new qi(t,n):new Vi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(wi(e,this.value)):null!==e&&vi(this.value)===vi(e)&&this.m(wi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Vr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Ui=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=yi.fromName(r.referenceValue),i}return Object(Ar.c)(e,t),e.prototype.matches=function(t){var e=yi.comparator(t.key,this.key);return this.m(e)},e}(Fi),qi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Bi(0,n),r}return Object(Ar.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(Fi),Vi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Bi(0,n),r}return Object(Ar.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(Fi);function Bi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return yi.fromName(t.referenceValue)})}var Ki=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(Ar.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Si(e)&&bi(e.arrayValue,this.value)},e}(Fi),Gi=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(Ar.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&bi(this.value.arrayValue,e)},e}(Fi),zi=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(Ar.c)(e,t),e.prototype.matches=function(t){if(bi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!bi(this.value.arrayValue,e)},e}(Fi),Qi=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(Ar.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Si(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return bi(e.value.arrayValue,t)})},e}(Fi),Wi=function(t,e){this.position=t,this.before=e};function Hi(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return _i(t)}).join(",")}var Yi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Xi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ji(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?yi.comparator(yi.fromName(s.referenceValue),n.key):wi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function $i(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!mi(t.position[n],e.position[n]))return!1;return!0}var Zi=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function to(t,e,n,r,i,o,s,a){return new Zi(t,e,n,r,i,o,s,a)}function eo(t){return new Zi(t)}function no(t){return!di(t.limit)&&"F"===t.limitType}function ro(t){return!di(t.limit)&&"L"===t.limitType}function io(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function oo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function so(t){return null!==t.collectionGroup}function ao(t){var e=Kr(t);if(null===e.p){e.p=[];var n=oo(e),r=io(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Yi(n)),e.p.push(new Yi(ri.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Yi(ri.keyField(),u))}}}return e.p}function uo(t){var e=Kr(t);if(!e.T)if("F"===e.limitType)e.T=ji(e.path,e.collectionGroup,ao(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=ao(e);r<i.length;r++){var o=i[r];n.push(new Yi(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new Wi(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Wi(e.startAt.position,!e.startAt.before):null;e.T=ji(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function co(t,e,n){return new Zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ho(t,e){return Ri(uo(t),uo(e))&&t.limitType===e.limitType}function lo(t){return Mi(uo(t))+"|lt:"+t.limitType}function fo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+_i(e.value);var e}).join(", ")+"]"),di(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Hi(t.startAt)),t.endAt&&(e+=", endAt: "+Hi(t.endAt)),"Target("+e+")"}(uo(t))+"; limitType="+t.limitType+")"}function po(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):yi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Ji(t.startAt,ao(t),e)||t.endAt&&Ji(t.endAt,ao(t),e))}(t,e)}function go(t){return function(e,n){for(var r=!1,i=0,o=ao(t);i<o.length;i++){var s=o[i],a=yo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function yo(t,e,n){var r=t.field.isKeyField()?yi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?wi(r,i):Vr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Vr()}}function vo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pi(e)?"-0":e}}function mo(t){return{integerValue:""+t}}function bo(t,e){return gi(e)?mo(e):vo(t,e)}var wo=function(){this._=void 0};function Oo(t,e,n){return t instanceof To?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Eo?So(t,e):t instanceof Co?xo(t,e):function(t,e){var n=Io(t,e),r=No(n)+No(t.A);return Ei(n)&&Ei(t.A)?mo(r):vo(t.R,r)}(t,e)}function _o(t,e,n){return t instanceof Eo?So(t,e):t instanceof Co?xo(t,e):n}function Io(t,e){return t instanceof Po?Ei(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var To=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Ar.c)(e,t),e}(wo),Eo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Ar.c)(e,t),e}(wo);function So(t,e){for(var n=Ao(e),r=function(t){n.some(function(e){return mi(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Co=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Ar.c)(e,t),e}(wo);function xo(t,e){for(var n=Ao(e),r=function(t){n=n.filter(function(e){return!mi(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Po=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(Ar.c)(e,t),e}(wo);function No(t){return ui(t.integerValue||t.doubleValue)}function Ao(t){return Si(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Do=function(t,e){this.field=t,this.transform=e},ko=function(t,e){this.version=t,this.transformResults=e},jo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Mo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Ro=function(){};function Lo(t,e,n){t instanceof Bo?function(t,e,n){var r=t.value.clone(),i=zo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Ko?function(t,e,n){if(Mo(t.precondition,e)){var r=zo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Go(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Fo(t,e,n){t instanceof Bo?function(t,e,n){if(Mo(t.precondition,e)){var r=t.value.clone(),i=Qo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Vo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Ko?function(t,e,n){if(Mo(t.precondition,e)){var r=Qo(t.fieldTransforms,n,e),i=e.data;i.setAll(Go(t)),i.setAll(r),e.convertToFoundDocument(Vo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Mo(t.precondition,e)&&e.convertToNoDocument(Xr.min())}(t,e)}function Uo(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Io(o.transform,s||null);null!=a&&(null==n&&(n=Ni.empty()),n.set(o.field,a))}return n||null}function qo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Wr(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Eo&&e instanceof Eo||t instanceof Co&&e instanceof Co?Wr(t.elements,e.elements,mi):t instanceof Po&&e instanceof Po?mi(t.A,e.A):t instanceof To&&e instanceof To}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Vo(t){return t.isFoundDocument()?t.version:Xr.min()}var Bo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(Ar.c)(e,t),e}(Ro),Ko=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(Ar.c)(e,t),e}(Ro);function Go(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function zo(t,e,n){var r=new Map;Br(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,_o(s,a,n[i]))}return r}function Qo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Oo(a,u,e))}return r}var Wo,Ho,Yo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(Ar.c)(e,t),e}(Ro),Xo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(Ar.c)(e,t),e}(Ro),Jo=function(t){this.count=t};function $o(t){switch(t){case kr.OK:return Vr();case kr.CANCELLED:case kr.UNKNOWN:case kr.DEADLINE_EXCEEDED:case kr.RESOURCE_EXHAUSTED:case kr.INTERNAL:case kr.UNAVAILABLE:case kr.UNAUTHENTICATED:return!1;case kr.INVALID_ARGUMENT:case kr.NOT_FOUND:case kr.ALREADY_EXISTS:case kr.PERMISSION_DENIED:case kr.FAILED_PRECONDITION:case kr.ABORTED:case kr.OUT_OF_RANGE:case kr.UNIMPLEMENTED:case kr.DATA_LOSS:return!0;default:return Vr()}}function Zo(t){if(void 0===t)return Fr("GRPC error has no .code"),kr.UNKNOWN;switch(t){case Wo.OK:return kr.OK;case Wo.CANCELLED:return kr.CANCELLED;case Wo.UNKNOWN:return kr.UNKNOWN;case Wo.DEADLINE_EXCEEDED:return kr.DEADLINE_EXCEEDED;case Wo.RESOURCE_EXHAUSTED:return kr.RESOURCE_EXHAUSTED;case Wo.INTERNAL:return kr.INTERNAL;case Wo.UNAVAILABLE:return kr.UNAVAILABLE;case Wo.UNAUTHENTICATED:return kr.UNAUTHENTICATED;case Wo.INVALID_ARGUMENT:return kr.INVALID_ARGUMENT;case Wo.NOT_FOUND:return kr.NOT_FOUND;case Wo.ALREADY_EXISTS:return kr.ALREADY_EXISTS;case Wo.PERMISSION_DENIED:return kr.PERMISSION_DENIED;case Wo.FAILED_PRECONDITION:return kr.FAILED_PRECONDITION;case Wo.ABORTED:return kr.ABORTED;case Wo.OUT_OF_RANGE:return kr.OUT_OF_RANGE;case Wo.UNIMPLEMENTED:return kr.UNIMPLEMENTED;case Wo.DATA_LOSS:return kr.DATA_LOSS;default:return Vr()}}(Ho=Wo||(Wo={}))[Ho.OK=0]="OK",Ho[Ho.CANCELLED=1]="CANCELLED",Ho[Ho.UNKNOWN=2]="UNKNOWN",Ho[Ho.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ho[Ho.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ho[Ho.NOT_FOUND=5]="NOT_FOUND",Ho[Ho.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ho[Ho.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ho[Ho.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ho[Ho.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ho[Ho.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ho[Ho.ABORTED=10]="ABORTED",Ho[Ho.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ho[Ho.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ho[Ho.INTERNAL=13]="INTERNAL",Ho[Ho.UNAVAILABLE=14]="UNAVAILABLE",Ho[Ho.DATA_LOSS=15]="DATA_LOSS";var ts=function(){function t(t,e){this.comparator=t,this.root=e||ns.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ns.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ns.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new es(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new es(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new es(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new es(this.root,t,this.comparator,!0)},t}(),es=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),ns=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Vr();if(this.right.isRed())throw Vr();var t=this.left.check();if(t!==this.right.check())throw Vr();return t+(this.isRed()?0:1)},t}();ns.EMPTY=null,ns.RED=!0,ns.BLACK=!1,ns.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Vr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Vr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Vr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Vr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Vr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new ns(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var rs=function(){function t(t){this.comparator=t,this.data=new ts(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new is(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new is(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),is=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),os=new ts(yi.comparator);function ss(){return os}var as=new ts(yi.comparator);function us(){return as}var cs=new ts(yi.comparator);function hs(){return cs}var ls=new rs(yi.comparator);function fs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ls,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var ds=new rs(Qr);function ps(){return ds}var gs=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ys.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Xr.min(),r,ps(),ss(),fs())},t}(),ys=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(oi.EMPTY_BYTE_STRING,n,fs(),fs(),fs())},t}(),vs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ms=function(t,e){this.targetId=t,this.V=e},bs=function(t,e,n,r){void 0===n&&(n=oi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ws=function(){function t(){this.S=0,this.D=Is(),this.C=oi.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=fs(),e=fs(),n=fs();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Vr()}}),new ys(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Is()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Os=function(){function t(t){this.W=t,this.G=new Map,this.H=ss(),this.J=_s(),this.Y=new rs(Qr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:Vr()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Li(i))if(0===n){var o=new yi(i.path);this.tt(e,o,Di.newNoDocument(o,Xr.min()))}else Br(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.at=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Li(o.target)){var s=new yi(o.target.path);null!==e.H.get(s)||e.ut(i,s)||e.tt(i,s,Di.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}});var r=fs();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new gs(t,n,this.Y,this.H,r);return this.H=ss(),this.J=_s(),this.Y=new rs(Qr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.ut(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.ut(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ws,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new rs(Qr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Lr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new ws),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.ut=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function _s(){return new ts(yi.comparator)}function Is(){return new ts(yi.comparator)}var Ts={asc:"ASCENDING",desc:"DESCENDING"},Es={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ss=function(t,e){this.databaseId=t,this.I=e};function Cs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function xs(t,e){return t.I?e.toBase64():e.toUint8Array()}function Ps(t,e){return Cs(t,e.toTimestamp())}function Ns(t){return Br(!!t),Xr.fromTimestamp(function(t){var e=ai(t);return new Yr(e.seconds,e.nanos)}(t))}function As(t,e){return function(t){return new ei(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ds(t){var e=ei.fromString(t);return Br(na(e)),e}function ks(t,e){return As(t.databaseId,e.path)}function js(t,e){var n=Ds(e);if(n.get(1)!==t.databaseId.projectId)throw new jr(kr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new jr(kr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new yi(Fs(n))}function Ms(t,e){return As(t.databaseId,e)}function Rs(t){var e=Ds(t);return 4===e.length?ei.emptyPath():Fs(e)}function Ls(t){return new ei(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Fs(t){return Br(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Us(t,e,n){return{name:ks(t,e),fields:n.toProto().mapValue.fields}}function qs(t,e,n){var r=js(t,e.name),i=Ns(e.updateTime),o=new Ni({mapValue:{fields:e.fields}}),s=Di.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Vs(t,e){var n;if(e instanceof Bo)n={update:Us(t,e.key,e.value)};else if(e instanceof Yo)n={delete:ks(t,e.key)};else if(e instanceof Ko)n={update:Us(t,e.key,e.data),updateMask:ea(e.fieldMask)};else{if(!(e instanceof Xo))return Vr();n={verify:ks(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof To)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Eo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Co)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Po)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Vr()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ps(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Vr()}(t,e.precondition)),n}function Bs(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?jo.updateTime(Ns(t.updateTime)):void 0!==t.exists?jo.exists(t.exists):jo.none()}(e.currentDocument):jo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(Br("REQUEST_TIME"===e.setToServerValue),n=new To):"appendMissingElements"in e?n=new Eo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new Co(e.removeAllFromArray.values||[]):"increment"in e?n=new Po(t,e.increment):Vr();var r=ri.fromServerFormat(e.fieldPath);return new Do(r,n)}(t,e)}):[];if(e.update){var i=js(t,e.update.name),o=new Ni({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new ii((t.fieldPaths||[]).map(function(t){return ri.fromServerFormat(t)}))}(e.updateMask);return new Ko(i,o,s,n,r)}return new Bo(i,o,n,r)}if(e.delete){var a=js(t,e.delete);return new Yo(a,n)}if(e.verify){var u=js(t,e.verify);return new Xo(u,n)}return Vr()}function Ks(t,e){return{documents:[Ms(t,e.path)]}}function Gs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ms(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ms(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(xi(t.value))return{unaryFilter:{field:Js(t.field),op:"IS_NAN"}};if(Ci(t.value))return{unaryFilter:{field:Js(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(xi(t.value))return{unaryFilter:{field:Js(t.field),op:"IS_NOT_NAN"}};if(Ci(t.value))return{unaryFilter:{field:Js(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Js(t.field),op:Xs(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Js(t.field),direction:Ys(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||di(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Ws(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ws(e.endAt)),n}function zs(t){var e=Rs(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Br(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Qs(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new Yi($s(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return di(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Hs(n.startAt));var h=null;return n.endAt&&(h=Hs(n.endAt)),to(e,i,a,s,u,"F",c,h)}function Qs(t){return t?void 0!==t.unaryFilter?[ta(t)]:void 0!==t.fieldFilter?[Zs(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Qs(t)}).reduce(function(t,e){return t.concat(e)}):Vr():[]}function Ws(t){return{before:t.before,values:t.position}}function Hs(t){return new Wi(t.values||[],!!t.before)}function Ys(t){return Ts[t]}function Xs(t){return Es[t]}function Js(t){return{fieldPath:t.canonicalString()}}function $s(t){return ri.fromServerFormat(t.fieldPath)}function Zs(t){return Fi.create($s(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Vr()}}(t.fieldFilter.op),t.fieldFilter.value)}function ta(t){switch(t.unaryFilter.op){case"IS_NAN":var e=$s(t.unaryFilter.field);return Fi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=$s(t.unaryFilter.field);return Fi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=$s(t.unaryFilter.field);return Fi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=$s(t.unaryFilter.field);return Fi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Vr()}}function ea(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function na(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ra(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=oa(e)),e=ia(t.get(n),e);return oa(e)}function ia(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function oa(t){return t+"\x01\x01"}function sa(t){var e=t.length;if(Br(e>=2),2===e)return Br("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),ei.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Vr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Vr()}o=s+2}return new ei(r)}var aa=function(t,e){this.seconds=t,this.nanoseconds=e},ua=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};ua.store="owner",ua.key="owner";var ca=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ca.store="mutationQueues",ca.keyPath="userId";var ha=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ha.store="mutations",ha.keyPath="batchId",ha.userMutationsIndex="userMutationsIndex",ha.userMutationsKeyPath=["userId","batchId"];var la=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,ra(e)]},t.key=function(t,e,n){return[t,ra(e),n]},t}();la.store="documentMutations",la.PLACEHOLDER=new la;var fa=function(t,e){this.path=t,this.readTime=e},da=function(t,e){this.path=t,this.version=e},pa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};pa.store="remoteDocuments",pa.readTimeIndex="readTimeIndex",pa.readTimeIndexPath="readTime",pa.collectionReadTimeIndex="collectionReadTimeIndex",pa.collectionReadTimeIndexPath=["parentPath","readTime"];var ga=function(t){this.byteSize=t};ga.store="remoteDocumentGlobal",ga.key="remoteDocumentGlobalKey";var ya=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};ya.store="targets",ya.keyPath="targetId",ya.queryTargetsIndexName="queryTargetsIndex",ya.queryTargetsKeyPath=["canonicalId","targetId"];var va=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};va.store="targetDocuments",va.keyPath=["targetId","path"],va.documentTargetsIndex="documentTargetsIndex",va.documentTargetsKeyPath=["path","targetId"];var ma=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ma.key="targetGlobalKey",ma.store="targetGlobal";var ba=function(t,e){this.collectionId=t,this.parent=e};ba.store="collectionParents",ba.keyPath=["collectionId","parent"];var wa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};wa.store="clientMetadata",wa.keyPath="clientId";var Oa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Oa.store="bundles",Oa.keyPath="bundleId";var _a=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};_a.store="namedQueries",_a.keyPath="name";var Ia=Object(Ar.f)(Object(Ar.f)([],Object(Ar.f)(Object(Ar.f)([],Object(Ar.f)(Object(Ar.f)([],Object(Ar.f)(Object(Ar.f)([],[ca.store,ha.store,la.store,pa.store,ya.store,ua.store,ma.store,va.store]),[wa.store])),[ga.store])),[ba.store])),[Oa.store,_a.store]),Ta="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ea=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Sa=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},Ca=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Vr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),xa=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Sa,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Aa(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Ra(e.target.error);n.ft.reject(new Aa(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Aa(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Lr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ka(e)},t}(),Pa=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(C.i)())&&Fr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Lr("SimpleDb","Removing database:",t),ja(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(C.i)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(Ar.b)(this,void 0,void 0,function(){var e,n=this;return Object(Ar.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Lr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Aa(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new jr(kr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Aa(t,n))},i.onupgradeneeded=function(t){Lr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Lr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(Ar.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(Ar.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(Ar.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=xa.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),Ca.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Lr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Na=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return ja(this.Pt.delete())},t}(),Aa=function(t){function e(e,n){var r=this;return(r=t.call(this,kr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(Ar.c)(e,t),e}(jr);function Da(t){return"IndexedDbTransactionError"===t.name}var ka=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Lr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Lr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ja(n)},t.prototype.add=function(t){return Lr("SimpleDb","ADD",this.store.name,t,t),ja(this.store.add(t))},t.prototype.get=function(t){var e=this;return ja(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Lr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Lr("SimpleDb","DELETE",this.store.name,t),ja(this.store.delete(t))},t.prototype.count=function(){return Lr("SimpleDb","COUNT",this.store.name),ja(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Lr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new Ca(function(n,r){e.onerror=function(t){var e=Ra(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new Ca(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Na(i),s=e(i.primaryKey,i.value,o);if(s instanceof Ca){var a=s.catch(function(t){return o.done(),Ca.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return Ca.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function ja(t){return new Ca(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Ra(t.target.error);n(e)}})}var Ma=!1;function Ra(t){var e=Pa._t(Object(C.i)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new jr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ma||(Ma=!0,setTimeout(function(){throw r},0)),r}}return t}var La=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(Ar.c)(e,t),e}(Ea);function Fa(t,e){var n=Kr(t);return Pa.It(n.Mt,e)}var Ua=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Lo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Fo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Fo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Xr.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},fs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Wr(this.mutations,t.mutations,function(t,e){return qo(t,e)})&&Wr(this.baseMutations,t.baseMutations,function(t,e){return qo(t,e)})},t}(),qa=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Br(e.mutations.length===r.length);for(var i=hs(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Va=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Xr.min()),void 0===o&&(o=Xr.min()),void 0===s&&(s=oi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Ba=function(t){this.Lt=t};function Ka(t,e){if(e.document)return qs(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=yi.fromSegments(e.noDocument.path),r=Ha(e.noDocument.readTime),i=Di.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=yi.fromSegments(e.unknownDocument.path);return r=Ha(e.unknownDocument.version),Di.newUnknownDocument(o,r)}return Vr()}function Ga(t,e,n){var r=za(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:ks(t,e.key),fields:e.data.toProto().mapValue.fields,updateTime:Cs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new pa(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Wa(e.version);return s=e.hasCommittedMutations,new pa(null,new fa(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Wa(e.version);return new pa(new da(c,h),null,null,!0,r,i)}return Vr()}function za(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Qa(t){var e=new Yr(t[0],t[1]);return Xr.fromTimestamp(e)}function Wa(t){var e=t.toTimestamp();return new aa(e.seconds,e.nanoseconds)}function Ha(t){var e=new Yr(t.seconds,t.nanoseconds);return Xr.fromTimestamp(e)}function Ya(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Bs(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return Bs(t.Lt,e)}),o=Yr.fromMillis(e.localWriteTimeMs);return new Ua(e.batchId,o,n,i)}function Xa(t){var e,n,r=Ha(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ha(t.lastLimboFreeSnapshotVersion):Xr.min();return void 0!==t.query.documents?(Br(1===(n=t.query).documents.length),e=uo(eo(Rs(n.documents[0])))):e=function(t){return uo(zs(t))}(t.query),new Va(e,t.targetId,0,t.lastListenSequenceNumber,r,i,oi.fromBase64String(t.resumeToken))}function Ja(t,e){var n,r=Wa(e.snapshotVersion),i=Wa(e.lastLimboFreeSnapshotVersion);n=Li(e.target)?Ks(t.Lt,e.target):Gs(t.Lt,e.target);var o=e.resumeToken.toBase64();return new ya(e.targetId,Mi(e.target),r,o,e.sequenceNumber,i,n)}function $a(t){var e=zs({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?co(e,e.limit,"L"):e}var Za=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return tu(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Ha(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return tu(t).put({bundleId:(n=e).id,createTime:Wa(Ns(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return eu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:$a(e.bundledQuery),readTime:Ha(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return eu(t).put(function(t){return{name:t.name,readTime:Wa(Ns(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function tu(t){return Fa(t,Oa.store)}function eu(t){return Fa(t,_a.store)}var nu=function(){function t(){this.Bt=new ru}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Ca.resolve()},t.prototype.getCollectionParents=function(t,e){return Ca.resolve(this.Bt.getEntries(e))},t}(),ru=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new rs(ei.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new rs(ei.comparator)).toArray()},t}(),iu=function(){function t(){this.qt=new ru}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:ra(i)};return ou(t).put(o)}return Ca.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Hr(e),""],!1,!0);return ou(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(sa(o.parent))}return n})},t}();function ou(t){return Fa(t,ba.store)}var su={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},au=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function uu(t,e,n){var r=t.store(ha.store),i=t.store(la.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Br(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=la.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return Ca.waitFor(o).next(function(){return c})}function cu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Vr();e=t.noDocument}return JSON.stringify(e).length}au.DEFAULT_COLLECTION_PERCENTILE=10,au.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,au.DEFAULT=new au(41943040,au.DEFAULT_COLLECTION_PERCENTILE,au.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),au.DISABLED=new au(-1,0,0);var hu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return Br(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return fu(t).Ot({index:ha.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=du(t),s=fu(t);return s.add({}).next(function(a){Br("number"==typeof a);for(var u=new Ua(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return Vs(t.Lt,e)}),i=n.mutations.map(function(e){return Vs(t.Lt,e)});return new ha(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new rs(function(t,e){return Qr(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],g=la.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(g,la.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Qt[a]=u.keys()}),Ca.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return fu(t).get(e).next(function(t){return t?(Br(t.userId===n.userId),Ya(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?Ca.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return fu(t).Ot({index:ha.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Br(e.batchId>=r),o=Ya(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return fu(t).Ot({index:ha.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return fu(t).Nt(ha.userMutationsIndex,n).next(function(t){return t.map(function(t){return Ya(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=la.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return du(t).Ot({range:i},function(r,i,s){var a=r[0],u=r[2],c=sa(r[1]);if(a===n.userId&&e.path.isEqual(c))return fu(t).get(u).next(function(t){if(!t)throw Vr();Br(t.userId===n.userId),o.push(Ya(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new rs(Qr),i=[];return e.forEach(function(e){var o=la.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=du(t).Ot({range:s},function(t,i,o){var s=t[0],a=t[2],u=sa(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),Ca.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=la.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new rs(Qr);return du(t).Ot({range:s},function(t,e,o){var s=t[0],u=t[2],c=sa(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(fu(t).get(e).next(function(t){if(null===t)throw Vr();Br(t.userId===n.userId),r.push(Ya(n.R,t))}))}),Ca.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return uu(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),Ca.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Ca.resolve();var r=IDBKeyRange.lowerBound(la.prefixForUser(e.userId)),i=[];return du(t).Ot({range:r},function(t,n,r){if(t[0]===e.userId){var o=sa(t[1]);i.push(o)}else r.done()}).next(function(){Br(0===i.length)})})},t.prototype.containsKey=function(t,e){return lu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return pu(t).get(this.userId).next(function(t){return t||new ca(e.userId,-1,"")})},t}();function lu(t,e,n){var r=la.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return du(t).Ot({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function fu(t){return Fa(t,ha.store)}function du(t){return Fa(t,la.store)}function pu(t){return Fa(t,ca.store)}var gu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),yu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new gu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return Xr.fromTimestamp(new Yr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return vu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return Br(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return vu(t).Ot(function(s,a){var u=Xa(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return Ca.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return vu(t).Ot(function(t,n){var r=Xa(n);e(r)})},t.prototype.Xt=function(t){return mu(t).get(ma.key).next(function(t){return Br(null!==t),t})},t.prototype.Zt=function(t,e){return mu(t).put(ma.key,e)},t.prototype.te=function(t,e){return vu(t).put(Ja(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Mi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return vu(t).Ot({range:r,index:ya.queryTargetsIndexName},function(t,n,r){var o=Xa(n);Ri(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=bu(t);return e.forEach(function(e){var s=ra(e.path);i.push(o.put(new va(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),Ca.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=bu(t);return Ca.forEach(e,function(e){var o=ra(e.path);return Ca.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=bu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=bu(t),i=fs();return r.Ot({range:n,kt:!0},function(t,e,n){var r=sa(t[1]),o=new yi(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=ra(e.path),r=IDBKeyRange.bound([n],[Hr(n)],!1,!0),i=0;return bu(t).Ot({index:va.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return vu(t).get(e).next(function(t){return t?Xa(t):null})},t}();function vu(t){return Fa(t,ya.store)}function mu(t){return Fa(t,ma.store)}function bu(t){return Fa(t,va.store)}function wu(t){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(e){if(t.code!==kr.FAILED_PRECONDITION||t.message!==Ta)throw t;return Lr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Ou(t,e){var n=t[1],r=e[1],i=Qr(t[0],e[0]);return 0===i?Qr(n,r):i}var _u=function(){function t(t){this.ne=t,this.buffer=new rs(Ou),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Ou(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Iu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ae(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ae=function(t){var e=this,n=this.oe?3e5:6e4;Lr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(Ar.b)(e,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Da(e=n.sent())?(Lr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,wu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ae(t)];case 8:return n.sent(),[2]}})})})},t}(),Tu=function(){function t(t,e){this.ue=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ue.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Ca.resolve(Dr.o);var r=new _u(e);return this.ue.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ue.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ue.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ue.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Lr("LruGarbageCollector","Garbage collection skipped; disabled"),Ca.resolve(su)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Lr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),su):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ue.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Lr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Rr()<=x.a.DEBUG&&Lr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),Ca.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Eu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Tu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Su(t,n)},t.prototype.removeReference=function(t,e,n){return Su(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Su(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return pu(t).$t(function(r){return lu(t,r,e).next(function(t){return t&&(n=!0),Ca.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),bu(t).delete([0,ra(s.path)])})});i.push(u)}}).next(function(){return Ca.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Su(t,e)},t.prototype.we=function(t,e){var n,r=bu(t),i=Dr.o;return r.Ot({index:va.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Dr.o&&e(new yi(sa(n)),i),i=s,n=o):i=Dr.o}).next(function(){i!==Dr.o&&e(new yi(sa(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Su(t,e){return bu(t).put(function(t,e){return new va(0,ra(t.path),e)}(e,t.currentSequenceNumber))}var Cu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){$r(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return Zr(this.inner)},t}(),xu=function(){function t(){this.changes=new Cu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Xr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Di.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Ca.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Pu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Du(t).put(ku(e),n)},t.prototype.removeEntry=function(t,e){var n=Du(t),r=ku(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return Du(t).get(ku(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return Du(t).get(ku(e)).next(function(t){return{document:n.ye(e,t),size:cu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=ss();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=ss(),i=new ts(yi.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,cu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Ca.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Du(t).Ot({range:r},function(t,e,r){for(var s=yi.fromSegments(t);o&&yi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=ss(),o=e.path.length+1,s={};if(n.isEqual(Xr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=za(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=pa.collectionReadTimeIndex}return Du(t).Ot(s,function(t,n,s){if(t.length===o){var a=Ka(r.R,n);e.path.isPrefixOf(a.key.path)?po(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Nu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Au(t).get(ga.key).next(function(t){return Br(!!t),t})},t.prototype.me=function(t,e){return Au(t).put(ga.key,e)},t.prototype.ye=function(t,e){if(e){var n=Ka(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Xr.min()))return n}return Di.newInvalidDocument(t)},t}(),Nu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Cu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(Ar.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new rs(function(t,e){return Qr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Ga(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=cu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Ga(e.Ie.R,Di.newNoDocument(o,Xr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),Ca.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(xu);function Au(t){return Fa(t,ga.store)}function Du(t){return Fa(t,pa.store)}function ku(t){return t.path.toArray()}var ju=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Br(n<r&&n>=0&&r<=11);var o=new xa("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(ua.store)}(t),function(t){t.createObjectStore(ca.store,{keyPath:ca.keyPath}),t.createObjectStore(ha.store,{keyPath:ha.keyPath,autoIncrement:!0}).createIndex(ha.userMutationsIndex,ha.userMutationsKeyPath,{unique:!0}),t.createObjectStore(la.store)}(t),Mu(t),function(t){t.createObjectStore(pa.store)}(t));var s=Ca.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(va.store),t.deleteObjectStore(ya.store),t.deleteObjectStore(ma.store)}(t),Mu(t)),s=s.next(function(){return function(t){var e=t.store(ma.store),n=new ma(0,0,Xr.min().toTimestamp(),0);return e.put(ma.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(ha.store).Nt().next(function(n){t.deleteObjectStore(ha.store),t.createObjectStore(ha.store,{keyPath:ha.keyPath,autoIncrement:!0}).createIndex(ha.userMutationsIndex,ha.userMutationsKeyPath,{unique:!0});var r=e.store(ha.store),i=n.map(function(t){return r.put(t)});return Ca.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(wa.store,{keyPath:wa.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(ga.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(pa.store);e.createIndex(pa.readTimeIndex,pa.readTimeIndexPath,{unique:!1}),e.createIndex(pa.collectionReadTimeIndex,pa.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(Oa.store,{keyPath:Oa.keyPath})}(t),function(t){t.createObjectStore(_a.store,{keyPath:_a.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(pa.store).Ot(function(t,n){e+=cu(n)}).next(function(){var n=new ga(e);return t.store(ga.store).put(ga.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(ca.store),r=t.store(ha.store);return n.Nt().next(function(n){return Ca.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ha.userMutationsIndex,i).next(function(r){return Ca.forEach(r,function(r){Br(r.userId===n.userId);var i=Ya(e.R,r);return uu(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(va.store),n=t.store(pa.store);return t.store(ma.store).get(ma.key).next(function(t){var r=[];return n.Ot(function(n,i){var o=new ei(n),s=function(t){return[0,ra(t)]}(o);r.push(e.get(s).next(function(n){return n?Ca.resolve():function(n){return e.put(new va(0,ra(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return Ca.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(ba.store,{keyPath:ba.keyPath});var n=e.store(ba.store),r=new ru,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:ra(i)})}};return e.store(pa.store).Ot({kt:!0},function(t,e){var n=new ei(t);return i(n.popLast())}).next(function(){return e.store(la.store).Ot({kt:!0},function(t,e){var n=sa(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(ya.store);return n.Ot(function(t,r){var i=Xa(r),o=Ja(e.R,i);return n.put(o)})},t}();function Mu(t){t.createObjectStore(va.store,{keyPath:va.keyPath}).createIndex(va.documentTargetsIndex,va.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ya.store,{keyPath:ya.keyPath}).createIndex(ya.queryTargetsIndexName,ya.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ma.store)}var Ru="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Lu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new jr(kr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Eu(this,i),this.Le=n+"main",this.R=new Ba(u),this.Be=new Pa(this.Le,11,new ju(this.R)),this.qe=new yu(this.referenceDelegate,this.R),this.Ut=new iu,this.Ue=function(t,e){return new Pu(t,e)}(this.R,this.Ut),this.Qe=new Za,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&Fr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new jr(kr.FAILED_PRECONDITION,Ru);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new Dr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(Ar.b)(e,void 0,void 0,function(){return Object(Ar.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(Ar.b)(e,void 0,void 0,function(){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(Ar.b)(e,void 0,void 0,function(){return Object(Ar.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Uu(e).put(new wa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(Da(e))return Lr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Lr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return Fu(t).get(ua.key).next(function(t){return Ca.resolve(e.tn(t))})},t.prototype.en=function(t){return Uu(t).delete(this.clientId)},t.prototype.nn=function(){return Object(Ar.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=Fa(t,wa.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return Ca.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)this.Ke.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Ca.resolve(!0):Fu(t).get(ua.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new jr(kr.FAILED_PRECONDITION,Ru);return!1}}return!(!e.networkEnabled||!e.inForeground)||Uu(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Lr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(Ar.b)(this,void 0,void 0,function(){var t=this;return Object(Ar.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.an(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.un(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[ua.store,wa.store],function(e){var n=new La(e,Dr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Uu(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return hu.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Lr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ia,function(o){return r=new La(o,i.Ne?i.Ne.next():Dr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw Fr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new jr(kr.FAILED_PRECONDITION,Ta);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return Fu(t).get(ua.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new jr(kr.FAILED_PRECONDITION,Ru)})},t.prototype.Ze=function(t){var e=new ua(this.clientId,this.allowTabSynchronization,Date.now());return Fu(t).put(ua.key,e)},t.yt=function(){return Pa.yt()},t.prototype.Xe=function(t){var e=this,n=Fu(t);return n.get(ua.key).next(function(t){return e.tn(t)?(Lr("IndexedDbPersistence","Releasing primary lease."),n.delete(ua.key)):Ca.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Fr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.un=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.an(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return Lr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Fr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.an=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Fr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Fu(t){return Fa(t,ua.store)}function Uu(t){return Fa(t,wa.store)}function qu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Vu=function(t,e){this.progress=t,this.wn=e},Bu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return yi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):so(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new yi(e)).next(function(t){var e=us();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=us();return this.Ut.getCollectionParents(t,i).next(function(s){return Ca.forEach(s,function(s){var a=function(t,e){return new Zi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Di.newInvalidDocument(c),r=r.insert(c,h)),Fo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){po(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=fs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Ko&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),Ku=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=fs(),i=fs(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Gu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Xr.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(no(e)||ro(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Rr()<=x.a.DEBUG&&Lr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),fo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new rs(go(t));return e.forEach(function(e,r){po(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Rr()<=x.a.DEBUG&&Lr("QueryEngine","Using full collection scan to execute query:",fo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Xr.min())},t}(),zu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new ts(Qr),this.kn=new Cu(function(t){return Mi(t)},Ri),this.On=Xr.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Bu(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Qu(t,e,n,r){return new zu(t,e,n,r)}function Wu(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Ar.d)(this,function(s){switch(s.label){case 0:return n=Kr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Bu(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=fs(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var g=0,y=p.mutations;g<y.length;g++)s=s.add(y[g].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function Hu(t,e){var n=Kr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.$n.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Ca.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);Br(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function Yu(t){var e=Kr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function Xu(t,e){var n=Kr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Br(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=ss();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Ju(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(Xr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return Ca.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function Ju(t,e,n,r,i){var o=fs();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=ss();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Xr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Lr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function $u(t,e){var n=Kr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function Zu(t,e){var n=Kr(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?Ca.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new Va(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function tc(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Ar.d)(this,function(a){switch(a.label){case 0:r=Kr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Da(s=a.sent()))throw s;return Lr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function ec(t,e,n){var r=Kr(t),i=Xr.min(),o=fs();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=Kr(t),i=r.kn.get(n);return void 0!==i?Ca.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,uo(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Xr.min(),n?o:fs())}).next(function(t){return{documents:t,Bn:o}})})}function nc(t,e){var n=Kr(t),r=Kr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function rc(t){var e=Kr(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=Kr(t),i=ss(),o=za(n),s=Du(e),a=IDBKeyRange.lowerBound(o,!0);return s.Ot({index:pa.readTimeIndex,range:a},function(t,e){var n=Ka(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Qa(o)}})}(e.$n,t,e.On)}).then(function(t){var n=t.wn;return e.On=t.readTime,n})}function ic(t){return Object(Ar.b)(this,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){return[2,(e=Kr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Du(t),n=Xr.min();return e.Ot({index:pa.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Qa(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.On=t})]})})}function oc(t,e,n,r){return Object(Ar.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(Ar.d)(this,function(p){switch(p.label){case 0:for(i=Kr(t),o=fs(),s=ss(),a=hs(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Qn(h.metadata.readTime));return f=i.$n.newChangeBuffer({trackRemovals:!0}),[4,Zu(i,function(t){return uo(eo(ei.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Ju(t,f,s,Xr.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function sc(t,e,n){return void 0===n&&(n=fs()),Object(Ar.b)(this,void 0,void 0,function(){var r,i;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return[4,Zu(t,uo($a(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Kr(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=Ns(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(oi.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Qe.saveNamedQuery(t,e)})})]}})})}var ac=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Ca.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ns(n.createTime)}),Ca.resolve()},t.prototype.getNamedQuery=function(t,e){return Ca.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:$a(t.bundledQuery),readTime:Ns(t.readTime)}}(e)),Ca.resolve()},t}(),uc=function(){function t(){this.Wn=new rs(cc.Gn),this.zn=new rs(cc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new cc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new cc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new yi(new ei([])),r=new cc(n,t),i=new cc(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new yi(new ei([])),n=new cc(e,t),r=new cc(e,t+1),i=fs();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new cc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),cc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return yi.comparator(t.key,e.key)||Qr(t.ns,e.ns)},t.Hn=function(t,e){return Qr(t.ns,e.ns)||yi.comparator(t.key,e.key)},t}(),hc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new rs(cc.Gn)}return t.prototype.checkEmpty=function(t){return Ca.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Ua(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new cc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return Ca.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Ca.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return Ca.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Ca.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Ca.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new cc(e,0),i=new cc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),Ca.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new rs(Qr);return e.forEach(function(t){var e=new cc(t,0),i=new cc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),Ca.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;yi.isDocumentKey(i)||(i=i.child(""));var o=new cc(new yi(i),0),s=new rs(Qr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),Ca.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Br(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Ca.forEach(e.mutations,function(i){var o=new cc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new cc(e,0),r=this.rs.firstAfterOrEqual(n);return Ca.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return Ca.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),lc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new ts(yi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Ca.resolve(n?n.document.clone():Di.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=ss();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Di.newInvalidDocument(t))}),Ca.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=ss(),i=new yi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||po(e,u)&&(r=r.insert(u.key,u.clone()))}return Ca.resolve(r)},t.prototype.fs=function(t,e){return Ca.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new fc(this)},t.prototype.getSize=function(t){return Ca.resolve(this.size)},t}(),fc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(Ar.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),Ca.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(xu),dc=function(){function t(t){this.persistence=t,this.ds=new Cu(function(t){return Mi(t)},Ri),this.lastRemoteSnapshotVersion=Xr.min(),this.highestTargetId=0,this.ws=0,this._s=new uc,this.targetCount=0,this.ys=gu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),Ca.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Ca.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Ca.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Ca.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Ca.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new gu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Ca.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Ca.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Ca.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),Ca.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return Ca.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Ca.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Ca.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),Ca.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Ca.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Ca.resolve(n)},t.prototype.containsKey=function(t,e){return Ca.resolve(this._s.containsKey(e))},t}(),pc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Dr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new dc(this),this.Ut=new nu,this.Ue=function(t,e){return new lc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new Ba(e),this.Qe=new ac(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new hc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;Lr("MemoryPersistence","Starting transaction:",t);var i=new gc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return Ca.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),gc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(Ar.c)(e,t),e}(Ea),yc=function(){function t(t){this.persistence=t,this.As=new uc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Vr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Ca.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Ca.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Ca.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ca.forEach(this.vs,function(r){var i=yi.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Ca.or([function(){return Ca.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),vc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function mc(t,e){return"firestore_clients_"+t+"_"+e}function bc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function wc(t,e){return"firestore_targets_"+t+"_"+e}vc.UNAUTHENTICATED=new vc(null),vc.GOOGLE_CREDENTIALS=new vc("google-credentials-uid"),vc.FIRST_PARTY=new vc("first-party-uid");var Oc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new jr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Fr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),_c=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new jr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Fr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Ic=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ps(),s=0;i&&s<r.activeTargetIds.length;++s)i=gi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Fr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Tc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Fr("SharedClientState","Failed to parse online state: "+e),null)},t}(),Ec=function(){function t(){this.activeTargetIds=ps()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Sc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new ts(Qr),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=mc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Ec),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(Ar.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(Ar.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(mc(this.persistenceKey,r)))&&(o=Ic.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.Os;u<c.length;u++)this.Fs(c[u]);return this.Os=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(wc(this.persistenceKey,t));if(n){var r=_c.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(wc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Lr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Lr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Lr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Lr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void Fr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(Ar.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(Ar.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Dr.o;if(null!=t)try{var n=JSON.parse(t);Br("number"==typeof n),e=n}catch(t){Fr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Dr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Oc(this.currentUser,t,e,n),i=bc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=bc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=wc(this.persistenceKey,t),i=new _c(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Ic.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Oc.Vs(new vc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return _c.Vs(r,e)},t.prototype.js=function(t){return Tc.Vs(t)},t.prototype.ii=function(t){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ai(t.batchId,t.state,t.error)]:(Lr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ui(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ps();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),Cc=function(){function t(){this.li=new Ec,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Ec,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),xc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Pc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Lr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Lr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Nc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Ac=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Dc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return Object(Ar.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new Nr;s.listenOnce(Cr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Sr.NO_ERROR:var e=s.getResponseJson();Lr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Sr.TIMEOUT:Lr("Connection",'RPC "'+t+'" timed out'),o(new jr(kr.DEADLINE_EXCEEDED,"Request time out"));break;case Sr.HTTP_ERROR:var n=s.getStatus();if(Lr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(kr).indexOf(e)>=0?e:kr.UNKNOWN}(r.status);o(new jr(a,r.message))}else o(new jr(kr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new jr(kr.UNAVAILABLE,"Connection failed."));break;default:Vr()}}finally{Lr("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Or,i=Ie(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(o.initMessageHeaders,e),Object(C.n)()||Object(C.p)()||Object(C.l)()||Object(C.m)()||Object(C.q)()||Object(C.k)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Lr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Ac({Ei:function(t){c?Lr("Connection","Not sending because WebChannel is closed:",t):(u||(Lr("Connection","Opening WebChannel transport."),a.open(),u=!0),Lr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,Pr.EventType.OPEN,function(){c||Lr("Connection","WebChannel transport opened.")}),l(a,Pr.EventType.CLOSE,function(){c||(c=!0,Lr("Connection","WebChannel transport closed"),h.Vi())}),l(a,Pr.EventType.ERROR,function(t){c||(c=!0,Ur("Connection","WebChannel transport errored:",t),h.Vi(new jr(kr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Pr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];Br(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Lr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=Wo[t];if(void 0!==e)return Zo(e)}(i),s=r.message;void 0===o&&(o=kr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new jr(o,s)),a.close()}else Lr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,xr.STAT_EVENT,function(t){10===t.stat?Lr("Connection","Detected buffering proxy"):11===t.stat&&Lr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Lr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Lr("RestConnection","Received: ",t),t},function(e){throw Ur("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.6.2",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Nc[t]},t}());function kc(){return"undefined"!=typeof window?window:null}function jc(){return"undefined"!=typeof document?document:null}function Mc(t){return new Ss(t,!0)}var Rc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&Lr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Lc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Rc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ar(),this.stream.send(t)},t.prototype.rr=function(){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ar=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(n){switch(n.label){case 0:return this.ar(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===kr.RESOURCE_EXHAUSTED?(Fr(e.toString()),Fr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===kr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ur(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ur=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new jr(kr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(Ar.b)(t,void 0,void 0,function(){return Object(Ar.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Lr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Lr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Fc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(Ar.c)(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Vr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Br(void 0===e||"string"==typeof e),oi.fromBase64String(e||"")):(Br(void 0===e||e instanceof Uint8Array),oi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?kr.UNKNOWN:Zo(t.code);return new jr(e,t.message||"")}(a);n=new bs(r,i,o,s||null)}else if("documentChange"in e){i=js(t,(r=e.documentChange).document.name),o=Ns(r.document.updateTime);var a=new Ni({mapValue:{fields:r.document.fields}}),u=(s=Di.newFoundDocument(i,o,a),r.targetIds||[]);n=new vs(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=js(t,(r=e.documentDelete).document),o=r.readTime?Ns(r.readTime):Xr.min(),a=Di.newNoDocument(i,o),n=new vs([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=js(t,(r=e.documentRemove).document),n=new vs([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Vr();var c=e.filter;i=new Jo(r=c.count||0),n=new ms(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Xr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Xr.min():e.readTime?Ns(e.readTime):Xr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Ls(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Li(r)?{documents:Ks(t,r)}:{query:Gs(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=xs(t,e.resumeToken):e.snapshotVersion.compareTo(Xr.min())>0&&(n.readTime=Cs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Vr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Ls(this.R),e.removeTarget=t,this.cr(e)},e}(Lc),Uc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(Ar.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ur=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(Br(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Br(void 0!==e),t.map(function(t){return function(t,e){var n=Ns(t.updateTime?t.updateTime:e);return n.isEqual(Xr.min())&&(n=Ns(e)),new ko(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Ns(t.commitTime);return this.listener.Tr(n,e)}return Br(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Ls(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Vs(e.R,t)})};this.cr(n)},e}(Lc),qc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(Ar.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new jr(kr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===kr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new jr(kr.UNKNOWN,t.toString())})},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Oi(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===kr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new jr(kr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),Vc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Fr(e),this.Vr=!1):Lr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Bc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(Ar.b)(o,void 0,void 0,function(){return Object(Ar.d)(this,function(t){switch(t.label){case 0:return Jc(this)?(Lr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(Ar.b)(this,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:return(e=Kr(t)).$r.add(4),[4,Gc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,Kc(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new Vc(n,r)};function Kc(t){return Object(Ar.b)(this,void 0,void 0,function(){var e,n;return Object(Ar.d)(this,function(r){switch(r.label){case 0:if(!Jc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Gc(t){return Object(Ar.b)(this,void 0,void 0,function(){var e,n;return Object(Ar.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function zc(t,e){var n=Kr(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),Xc(n)?Yc(n):fh(n).er()&&Wc(n,e))}function Qc(t,e){var n=Kr(t),r=fh(n);n.Or.delete(e),r.er()&&Hc(n,e),0===n.Or.size&&(r.er()?r.ir():Jc(n)&&n.Br.set("Unknown"))}function Wc(t,e){t.qr.U(e.targetId),fh(t).mr(e)}function Hc(t,e){t.qr.U(e),fh(t).yr(e)}function Yc(t){t.qr=new Os({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),fh(t).start(),t.Br.Sr()}function Xc(t){return Jc(t)&&!fh(t).tr()&&t.Or.size>0}function Jc(t){return 0===Kr(t).$r.size}function $c(t){t.qr=void 0}function Zc(t){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(e){return t.Or.forEach(function(e,n){Wc(t,e)}),[2]})})}function th(t,e){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(n){return $c(t),Xc(t)?(t.Br.Nr(e),Yc(t)):t.Br.set("Unknown"),[2]})})}function eh(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r,i,o;return Object(Ar.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof bs&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Ar.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.Or.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.Or.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Lr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,nh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof vs?t.qr.X(e):e instanceof ms?t.qr.rt(e):t.qr.et(e),n.isEqual(Xr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Yu(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.at(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.Or.get(e);if(n){t.Or.set(e,n.withResumeToken(oi.EMPTY_BYTE_STRING,n.snapshotVersion)),Hc(t,e);var r=new Va(n.target,e,1,n.sequenceNumber);Wc(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Lr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,nh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function nh(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r=this;return Object(Ar.d)(this,function(i){switch(i.label){case 0:if(!Da(e))throw e;return t.$r.add(1),[4,Gc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Yu(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(Ar.b)(r,void 0,void 0,function(){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return Lr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,Kc(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function rh(t,e){return e().catch(function(n){return nh(t,n,e)})}function ih(t){return Object(Ar.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(Ar.d)(this,function(s){switch(s.label){case 0:e=Kr(t),n=dh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Jc(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,$u(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=dh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,nh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return oh(e)&&sh(e),[2]}})})}function oh(t){return Jc(t)&&!dh(t).tr()&&t.kr.length>0}function sh(t){dh(t).start()}function ah(t){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(e){return dh(t).Ar(),[2]})})}function uh(t){return Object(Ar.b)(this,void 0,void 0,function(){var e,n,r;return Object(Ar.d)(this,function(i){for(e=dh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function ch(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r,i;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=qa.from(r,e,n),[4,rh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,ih(t)];case 2:return o.sent(),[2]}})})}function hh(t,e){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(n){switch(n.label){case 0:return e&&dh(t).pr?[4,function(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return $o(r=e.code)&&r!==kr.ABORTED?(n=t.kr.shift(),dh(t).sr(),[4,rh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,ih(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return oh(t)&&sh(t),[2]}})})}function lh(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n;return Object(Ar.d)(this,function(r){switch(r.label){case 0:return n=Kr(t),e?(n.$r.delete(2),[4,Kc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,Gc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function fh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Kr(t);return r.br(),new Fc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Zc.bind(null,t),Ri:th.bind(null,t),_r:eh.bind(null,t)}),t.Mr.push(function(n){return Object(Ar.b)(e,void 0,void 0,function(){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Xc(t)?Yc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),$c(t),e.label=3;case 3:return[2]}})})})),t.Ur}function dh(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=Kr(t);return r.br(),new Uc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:ah.bind(null,t),Ri:hh.bind(null,t),Ir:uh.bind(null,t),Tr:ch.bind(null,t)}),t.Mr.push(function(n){return Object(Ar.b)(e,void 0,void 0,function(){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,ih(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(Lr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Qr}var ph=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Sa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new jr(kr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function gh(t,e){if(Fr("AsyncQueue",e+": "+t),Da(t))return new jr(kr.UNAVAILABLE,e+": "+t);throw t}var yh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||yi.comparator(e.key,n.key)}:function(t,e){return yi.comparator(t.key,e.key)},this.keyedMap=us(),this.sortedSet=new ts(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),vh=function(){function t(){this.Kr=new ts(yi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Vr():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),mh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,yh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ho(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),bh=function(){this.Wr=void 0,this.listeners=[]},wh=function(){this.queries=new Cu(function(t){return lo(t)},ho),this.onlineState="Unknown",this.Gr=new Set};function Oh(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Ar.d)(this,function(c){switch(c.label){case 0:if(n=Kr(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new bh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=gh(a,"Initialization of query '"+fo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Eh(n),[2]}})})}function _h(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Ar.d)(this,function(a){return n=Kr(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Ih(t,e){for(var n=Kr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Eh(n)}function Th(t,e,n){var r=Kr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Eh(t){t.Gr.forEach(function(t){t.next()})}var Sh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new mh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=mh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),Ch=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),xh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return js(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?qs(this.R,t.document,!1):Di.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return Ns(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new xh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||fs()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(Ar.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return[4,oc(this.localStore,new xh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,sc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Vu(Object.assign({},this.progress),t))]}})})}}();var Ph=function(t){this.key=t},Nh=function(t){this.key=t},Ah=function(){function t(t,e){this.query=t,this.ao=e,this.uo=null,this.current=!1,this.ho=fs(),this.mutatedKeys=fs(),this.lo=go(t),this.fo=new yh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.ao},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new vh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=no(this.query)&&i.size===this.query.limit?i.last():null,c=ro(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=po(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),no(this.query)||ro(this.query))for(;s.size>this.query.limit;){var h=no(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Vr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.uo;return this.uo=a,0!==o.length||u?{snapshot:new mh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new vh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.ao.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.ao=e.ao.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.ao=e.ao.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=fs(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Nh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Ph(t))}),n},t.prototype.Ao=function(t){this.ao=t.Bn,this.ho=fs();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return mh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.uo)},t}(),Dh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},kh=function(t){this.key=t,this.bo=!1},jh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Cu(function(t){return lo(t)},ho),this.Vo=new Map,this.So=new Set,this.Do=new ts(yi.comparator),this.Co=new Map,this.No=new uc,this.xo={},this.Fo=new Map,this.ko=gu.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function Mh(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Ar.d)(this,function(a){switch(a.label){case 0:return n=hl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Zu(n.localStore,uo(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Rh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&zc(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Rh(t,e,n,r){return Object(Ar.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(Ar.d)(this,function(h){switch(h.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return Object(Ar.b)(this,void 0,void 0,function(){var i,o,s;return Object(Ar.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,ec(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Yh(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,ec(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Ah(e,i.Bn),s=o._o(i.documents),a=ys.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Yh(t,n,u.To),c=new Dh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Lh(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return n=Kr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!ho(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,tc(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Qc(n.remoteStore,r.targetId),Wh(n,r.targetId)}).catch(wu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Wh(n,r.targetId),[4,tc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function Fh(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Ar.d)(this,function(a){switch(a.label){case 0:r=ll(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Kr(t),i=Yr.now(),o=e.reduce(function(t,e){return t.add(e.key)},fs());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Uo(c,n.get(c.key));null!=h&&s.push(new Ko(c.key,h,Ai(h.toProto().mapValue),jo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new ts(Qr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,$h(r,i.changes)];case 3:return a.sent(),[4,ih(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=gh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Uh(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r;return Object(Ar.d)(this,function(i){switch(i.label){case 0:n=Kr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Xu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(Br(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Br(r.bo):t.removedDocuments.size>0&&(Br(r.bo),r.bo=!1))}),[4,$h(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,wu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function qh(t,e,n){var r=Kr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=Kr(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Eh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Vh(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(Ar.d)(this,function(c){switch(c.label){case 0:return(r=Kr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new ts(yi.comparator)).insert(o,Di.newNoDocument(o,Xr.min())),a=fs().add(o),u=new gs(Xr.min(),new Map,new rs(Qr),s,a),[4,Uh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Jh(r),[3,4];case 2:return[4,tc(r.localStore,e,!1).then(function(){return Wh(r,e,n)}).catch(wu)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function Bh(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i;return Object(Ar.d)(this,function(o){switch(o.label){case 0:n=Kr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Hu(n.localStore,e)];case 2:return i=o.sent(),Qh(n,r,null),zh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,$h(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,wu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Kh(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r,i;return Object(Ar.d)(this,function(o){switch(o.label){case 0:r=Kr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Kr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return Br(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Qh(r,e,n),zh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,$h(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,wu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Gh(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Ar.d)(this,function(a){switch(a.label){case 0:Jc((n=Kr(t)).remoteStore)||Lr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Kr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=gh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function zh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Qh(t,e,n){var r=Kr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Wh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||Hh(t,e)})}function Hh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Qc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Jh(t))}function Yh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Ph?(t.No.addReference(o.key,e),Xh(t,o)):o instanceof Nh?(Lr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Hh(t,o.key)):Vr()}}function Xh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Lr("SyncEngine","New document in limbo: "+n),t.So.add(r),Jh(t))}function Jh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new yi(ei.fromString(e)),r=t.ko.next();t.Co.set(r,new kh(n)),t.Do=t.Do.insert(n,r),zc(t.remoteStore,new Va(uo(eo(n.path)),r,2,Dr.o))}}function $h(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Ar.d)(this,function(a){switch(a.label){case 0:return r=Kr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.$o(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Ku.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(Ar.d)(this,function(h){switch(h.label){case 0:n=Kr(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return Ca.forEach(e,function(e){return Ca.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return Ca.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!Da(r=h.sent()))throw r;return Lr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function Zh(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return(n=Kr(t)).currentUser.isEqual(e)?[3,3]:(Lr("SyncEngine","User change. New user:",e.toKey()),[4,Wu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new jr(kr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,$h(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function tl(t,e){var n=Kr(t),r=n.Co.get(e);if(r&&r.bo)return fs().add(r.key);var i=fs(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function el(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return[4,ec((n=Kr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Yh(n,e.targetId,i.To),i)]}})})}function nl(t){return Object(Ar.b)(this,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){return[2,rc((e=Kr(t)).localStore).then(function(t){return $h(e,t)})]})})}function rl(t,e,n,r){return Object(Ar.b)(this,void 0,void 0,function(){var i,o;return Object(Ar.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=Kr(t),r=Kr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):Ca.resolve(null)})})}((i=Kr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,ih(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Qh(i,e,r||null),zh(i,e),function(t,e){Kr(Kr(t)._n).Gt(e)}(i.localStore,e)):Vr(),s.label=4;case 4:return[4,$h(i,o)];case 5:return s.sent(),[3,7];case 6:Lr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function il(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Ar.d)(this,function(c){switch(c.label){case 0:return hl(n=Kr(t)),ll(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,ol(n,r.toArray())]);case 1:return i=c.sent(),n.Oo=!0,[4,lh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)zc(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return Wh(n,e),tc(n.localStore,e,!0)}),Qc(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,ol(n,a)];case 5:return c.sent(),function(t){var e=Kr(t);e.Co.forEach(function(t,n){Qc(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new ts(yi.comparator)}(n),n.Oo=!1,[4,lh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function ol(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(Ar.d)(this,function(g){switch(g.label){case 0:n=Kr(t),r=[],i=[],o=0,s=e,g.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,Zu(n.localStore,uo(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),h=0,l=c,g.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,el(n,f)]):[3,6];case 4:(d=g.sent()).snapshot&&i.push(d.snapshot),g.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,nc(n.localStore,a)];case 8:return p=g.sent(),[4,Zu(n.localStore,p)];case 9:return u=g.sent(),[4,Rh(n,sl(p),a,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function sl(t){return to(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function al(t){var e=Kr(t);return Kr(Kr(e.localStore).persistence).fn()}function ul(t,e,n,r){return Object(Ar.b)(this,void 0,void 0,function(){var i,o,s;return Object(Ar.d)(this,function(a){switch(a.label){case 0:return(i=Kr(t)).Oo?(Lr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,rc(i.localStore)];case 3:return o=a.sent(),s=gs.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,$h(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,tc(i.localStore,e,!0)];case 6:return a.sent(),Wh(i,e,r),[3,8];case 7:Vr(),a.label=8;case 8:return[2]}})})}function cl(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(Ar.d)(this,function(f){switch(f.label){case 0:if(!(r=hl(t)).Oo)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Lr("SyncEngine","Adding an already active target "+s),[3,5]):[4,nc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,Zu(r.localStore,a)];case 3:return u=f.sent(),[4,Rh(r,sl(a),u.targetId,!1)];case 4:f.sent(),zc(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,tc(r.localStore,t,!1).then(function(){Qc(r.remoteStore,t),Wh(r,t)}).catch(wu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function hl(t){var e=Kr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Uh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Vh.bind(null,e),e.vo._r=Ih.bind(null,e.eventManager),e.vo.Mo=Th.bind(null,e.eventManager),e}function ll(t){var e=Kr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Bh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Kh.bind(null,e),e}var fl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return this.R=Mc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Qu(this.persistence,new Gu,t.initialUser,this.R)},t.prototype.qo=function(t){return new pc(yc.bs,this.R)},t.prototype.Bo=function(t){return new Cc},t.prototype.terminate=function(){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),dl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(Ar.c)(e,t),e.prototype.initialize=function(e){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,ic(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,ll(this.Ko.syncEngine)];case 4:return n.sent(),[4,ih(this.Ko.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Qo=function(t){return Qu(this.persistence,new Gu,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Iu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=qu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?au.withCacheSize(this.cacheSizeBytes):au.DEFAULT;return new Lu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,kc(),jc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new Cc},e}(fl),pl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(Ar.c)(e,t),e.prototype.initialize=function(e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r=this;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof Sc?(this.sharedClientState.syncEngine={ai:rl.bind(null,n),ui:ul.bind(null,n),hi:cl.bind(null,n),fn:al.bind(null,n),ci:nl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(Ar.b)(r,void 0,void 0,function(){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return[4,il(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=kc();if(!Sc.yt(e))throw new jr(kr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=qu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Sc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(dl),gl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n=this;return Object(Ar.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return qh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Zh.bind(null,this.syncEngine),[4,lh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new wh},t.prototype.createDatastore=function(t){var e=Mc(t.databaseInfo.databaseId),n=new Dc(t.databaseInfo);return function(t,e,n){return new qc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return qh(s.syncEngine,t,0)},o=Pc.yt()?new Pc:new xc,new Bc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new jh(t,e,n,r,i,o);return s&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(Ar.b)(this,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:return e=Kr(t),Lr("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,Gc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),yl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),vl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Sa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(Ar.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new Ch(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(Ar.b)(this,void 0,void 0,function(){var t,e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(Ar.b)(this,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(Ar.b)(this,void 0,void 0,function(){var t,e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(Ar.b)(this,void 0,void 0,function(){var e,n=this;return Object(Ar.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new jr(kr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(Ar.d)(this,function(u){switch(u.label){case 0:return n=Kr(t),r=Ls(n.R)+"/documents",i={documents:e.map(function(t){return ks(n.R,t)})},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){Br(!!e.found);var n=js(t,e.found.name),r=Ns(e.found.updateTime),i=new Ni({mapValue:{fields:e.found.fields}});return Di.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Br(!!e.missing),Br(!!e.readTime);var n=js(t,e.missing),r=Ns(e.readTime);return Di.newNoDocument(n,r)}(t,e):Vr()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());Br(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Yo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(Ar.b)(this,void 0,void 0,function(){var t,e=this;return Object(Ar.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=yi.fromPath(n);e.mutations.push(new Xo(r,e.precondition(r)))}),[4,function(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return n=Kr(t),r=Ls(n.R)+"/documents",i={writes:e.map(function(t){return Vs(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Vr();e=Xr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new jr(kr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?jo.updateTime(e):jo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Xr.min()))throw new jr(kr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return jo.updateTime(e)}return jo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),ml=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Rc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(Ar.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(Ar.d)(this,function(r){return t=new vl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!di(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!$o(e)}return!1},t}(),bl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=vc.UNAUTHENTICATED,this.clientId=zr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(Ar.b)(r,void 0,void 0,function(){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return Lr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new jr(kr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Sa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Ar.b)(t,void 0,void 0,function(){var t,n;return Object(Ar.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=gh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function wl(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Lr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(Ar.b)(i,void 0,void 0,function(){return Object(Ar.d)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Wu(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function Ol(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,_l(t)];case 1:return n=i.sent(),Lr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(Ar.b)(this,void 0,void 0,function(){var n,r;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return(n=Kr(t)).asyncQueue.verifyOperationInProgress(),Lr("RemoteStore","RemoteStore received new credentials"),r=Jc(n),n.$r.add(3),[4,Gc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,Kc(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function _l(t){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Lr("FirestoreClient","Using default OfflineComponentProvider"),[4,wl(t,new fl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Il(t){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Lr("FirestoreClient","Using default OnlineComponentProvider"),[4,Ol(t,new gl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Tl(t){return _l(t).then(function(t){return t.persistence})}function El(t){return _l(t).then(function(t){return t.localStore})}function Sl(t){return Il(t).then(function(t){return t.remoteStore})}function Cl(t){return Il(t).then(function(t){return t.syncEngine})}function xl(t){return Object(Ar.b)(this,void 0,void 0,function(){var e,n;return Object(Ar.d)(this,function(r){switch(r.label){case 0:return[4,Il(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Mh.bind(null,e.syncEngine),n.onUnlisten=Lh.bind(null,e.syncEngine),n)]}})})}function Pl(t,e,n){var r=this;void 0===n&&(n={});var i=new Sa;return t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(r,void 0,void 0,function(){var r;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new yl({next:function(o){e.enqueueAndForget(function(){return _h(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new jr(kr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new jr(kr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Sh(eo(n.path),o,{includeMetadataChanges:!0,so:!0});return Oh(t,s)},[4,xl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Nl(t,e,n){var r=this;void 0===n&&(n={});var i=new Sa;return t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(r,void 0,void 0,function(){var r;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new yl({next:function(n){e.enqueueAndForget(function(){return _h(t,s)}),n.fromCache&&"server"===r.source?i.reject(new jr(kr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Sh(n,o,{includeMetadataChanges:!0,so:!0});return Oh(t,s)},[4,xl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Al=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},Dl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),kl=new Map,jl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Ml=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(vc.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Rl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Ll=function(){function t(t){var e=this;this.currentUser=vc.UNAUTHENTICATED,this.oc=new Sa,this.cc=0,this.changeListener=function(){return Promise.resolve()},this.ac=!1,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.hc(),e.oc.resolve(),e.ac&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){Lr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.lc(),e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):e.ac&&(Lr("FirebaseCredentialsProvider","Auth not yet detected"),e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)}))}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Lr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Br("string"==typeof n.accessToken),new jl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){this.ac=!0,this.asyncQueue=t,this.changeListener=e},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.hc=function(){var t=this.auth&&this.auth.getUid();return Br(null===t||"string"==typeof t),new vc(t)},t.prototype.lc=function(){var t=this;this.ac&&(this.ac=!1,this.asyncQueue.enqueueRetryable(function(){return Object(Ar.b)(t,void 0,void 0,function(){return Object(Ar.d)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,this.changeListener(this.currentUser)];case 2:return t.sent(),this.ac=!0,[2]}})})}))},t}(),Fl=function(){function t(t,e,n){this.fc=t,this.dc=e,this.wc=n,this.type="FirstParty",this.user=vc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.dc},e=this.fc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.wc&&(t["X-Goog-Iam-Authorization-Token"]=this.wc),t},enumerable:!1,configurable:!0}),t}(),Ul=function(){function t(t,e,n){this.fc=t,this.dc=e,this.wc=n}return t.prototype.getToken=function(){return Promise.resolve(new Fl(this.fc,this.dc,this.wc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(vc.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function ql(t,e,n){if(!n)throw new jr(kr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Vl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new jr(kr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Bl(t,e,n,r){if(!0===e&&!0===r)throw new jr(kr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Kl(t){if(!yi.isDocumentKey(t))throw new jr(kr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Gl(t){if(yi.isDocumentKey(t))throw new jr(kr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function zl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Vr()}function Ql(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new jr(kr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=zl(t);throw new jr(kr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Wl(t,e){if(e<=0)throw new jr(kr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Hl=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new jr(kr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new jr(kr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Bl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Yl=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hl({}),this._settingsFrozen=!1,t instanceof Dl?(this._databaseId=t,this._credentials=new Ml):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new jr(kr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Dl(t.options.projectId)}(t),this._credentials=new Ll(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new jr(kr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new jr(kr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Ml;switch(t.type){case"gapi":var e=t.client;return Br(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ul(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new jr(kr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=kl.get(this))&&(Lr("ComponentProvider","Removing Datastore"),kl.delete(this),t.terminate()),Promise.resolve();var t},t}(),Xl=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new $l(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Jl=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),$l=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,eo(r))||this)._path=r,i.type="collection",i}return Object(Ar.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Xl(this.firestore,null,new yi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Jl);function Zl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(C.h)(t),ql("collection","path",e),t instanceof Yl)return Gl(n=ei.fromString.apply(ei,Object(Ar.f)([e],r))),new $l(t,null,n);if(!(t instanceof Xl||t instanceof $l))throw new jr(kr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Gl(n=ei.fromString.apply(ei,Object(Ar.f)([t.path],r)).child(ei.fromString(e))),new $l(t.firestore,null,n)}function tf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(C.h)(t),1===arguments.length&&(e=zr.u()),ql("doc","path",e),t instanceof Yl)return Kl(n=ei.fromString.apply(ei,Object(Ar.f)([e],r))),new Xl(t,null,new yi(n));if(!(t instanceof Xl||t instanceof $l))throw new jr(kr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Kl(n=t._path.child(ei.fromString.apply(ei,Object(Ar.f)([e],r)))),new Xl(t.firestore,t instanceof $l?t.converter:null,new yi(n))}function ef(t,e){return t=Object(C.h)(t),e=Object(C.h)(e),(t instanceof Xl||t instanceof $l)&&(e instanceof Xl||e instanceof $l)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function nf(t,e){return t=Object(C.h)(t),e=Object(C.h)(e),t instanceof Jl&&e instanceof Jl&&t.firestore===e.firestore&&ho(t._query,e._query)&&t.converter===e.converter}var rf=function(){function t(){var t=this;this._c=Promise.resolve(),this.mc=[],this.yc=!1,this.gc=[],this.Ec=null,this.Tc=!1,this.Ic=[],this.Zi=new Rc(this,"async_queue_retry"),this.Ac=function(){var e=jc();e&&Lr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=jc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ac)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.yc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Rc(),this.bc(t)},t.prototype.enterRestrictedMode=function(){if(!this.yc){this.yc=!0;var t=jc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ac)}},t.prototype.enqueue=function(t){return this.Rc(),this.yc?new Promise(function(t){}):this.bc(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.mc.push(t),e.vc()})},t.prototype.vc=function(){return Object(Ar.b)(this,void 0,void 0,function(){var t,e=this;return Object(Ar.d)(this,function(n){switch(n.label){case 0:if(0===this.mc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.mc[0]()];case 2:return n.sent(),this.mc.shift(),this.Zi.reset(),[3,4];case 3:if(!Da(t=n.sent()))throw t;return Lr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.mc.length>0&&this.Zi.ji(function(){return e.vc()}),n.label=5;case 5:return[2]}})})},t.prototype.bc=function(t){var e=this,n=this._c.then(function(){return e.Tc=!0,t().catch(function(t){throw e.Ec=t,e.Tc=!1,Fr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.Tc=!1,t})});return this._c=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Rc(),this.Ic.indexOf(t)>-1&&(e=0);var i=ph.createAndSchedule(this,t,e,n,function(t){return r.Pc(t)});return this.gc.push(i),i},t.prototype.Rc=function(){this.Ec&&Vr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Vc=function(){return Object(Ar.b)(this,void 0,void 0,function(){var t;return Object(Ar.d)(this,function(e){switch(e.label){case 0:return[4,t=this._c];case 1:e.sent(),e.label=2;case 2:if(t!==this._c)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Sc=function(t){for(var e=0,n=this.gc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Dc=function(t){var e=this;return this.Vc().then(function(){e.gc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.gc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Vc()})},t.prototype.Cc=function(t){this.Ic.push(t)},t.prototype.Pc=function(t){var e=this.gc.indexOf(t);this.gc.splice(e,1)},t}();function of(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Sa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var sf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new rf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(Ar.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||uf(this),this._firestoreClient.terminate()},e}(Yl);function af(t){return t._firestoreClient||uf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function uf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Al(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new bl(t._credentials,t._queue,r)}function cf(t,e,n){var r=this,i=new Sa;return t.asyncQueue.enqueue(function(){return Object(Ar.b)(r,void 0,void 0,function(){var r;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,wl(t,n)];case 1:return o.sent(),[4,Ol(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===kr.FAILED_PRECONDITION||t.code===kr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function hf(t){if(t._initialized||t._terminated)throw new jr(kr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var lf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new jr(kr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ri(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),ff=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(oi.fromBase64String(e))}catch(e){throw new jr(kr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(oi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),df=function(t){this._methodName=t},pf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new jr(kr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new jr(kr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Qr(this._lat,t._lat)||Qr(this._long,t._long)},t}(),gf=/^__.*__$/,yf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Ko(t,this.data,this.fieldMask,e,this.fieldTransforms):new Bo(t,this.data,e,this.fieldTransforms)},t}(),vf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Ko(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function mf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Vr()}}var bf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Nc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xc",{get:function(){return this.settings.xc},enumerable:!1,configurable:!0}),t.prototype.Fc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Fc({path:n,Oc:!1});return r.$c(t),r},t.prototype.Mc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Fc({path:n,Oc:!1});return r.Nc(),r},t.prototype.Lc=function(t){return this.Fc({path:void 0,Oc:!0})},t.prototype.Bc=function(t){return Uf(t,this.settings.methodName,this.settings.qc||!1,this.path,this.settings.Uc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Nc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Bc("Document fields must not be empty");if(mf(this.xc)&&gf.test(t))throw this.Bc('Document fields cannot begin and end with "__"')},t}(),wf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Mc(t)}return t.prototype.Qc=function(t,e,n,r){return void 0===r&&(r=!1),new bf({xc:t,methodName:e,Uc:n,path:ri.emptyPath(),Oc:!1,qc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Of(t){var e=t._freezeSettings(),n=Mc(t._databaseId);return new wf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function _f(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Qc(o.merge||o.mergeFields?2:0,e,n,i);Mf("Data must be an object, but it was:",s,r);var a,u,c=kf(r,s);if(o.merge)a=new ii(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Rf(e,f[l],n);if(!s.contains(d))throw new jr(kr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");qf(h,d)||h.push(d)}a=new ii(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new yf(new Ni(c),a,u)}var If=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Ar.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.xc)throw t.Bc(1===t.xc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(df);function Tf(t,e,n){return new bf({xc:3,Uc:e.settings.Uc,methodName:t._methodName,Oc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Ef=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Ar.c)(e,t),e.prototype._toFieldTransform=function(t){return new Do(t.path,new To)},e.prototype.isEqual=function(t){return t instanceof e},e}(df),Sf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(Ar.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Tf(this,t,!0),n=this.Kc.map(function(t){return Df(t,e)}),r=new Eo(n);return new Do(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(df),Cf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(Ar.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Tf(this,t,!0),n=this.Kc.map(function(t){return Df(t,e)}),r=new Co(n);return new Do(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(df),xf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).jc=n,r}return Object(Ar.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new Po(t.R,bo(t.R,this.jc));return new Do(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(df);function Pf(t,e,n,r){var i=t.Qc(1,e,n);Mf("Data must be an object, but it was:",i,r);var o=[],s=Ni.empty();$r(r,function(t,r){var a=Ff(e,t,n);r=Object(C.h)(r);var u=i.Mc(a);if(r instanceof If)o.push(a);else{var c=Df(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new ii(o);return new vf(s,a,i.fieldTransforms)}function Nf(t,e,n,r,i,o){var s=t.Qc(1,e,n),a=[Rf(e,r,n)],u=[i];if(o.length%2!=0)throw new jr(kr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Rf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Ni.empty(),f=a.length-1;f>=0;--f)if(!qf(h,a[f])){var d=a[f],p=u[f];p=Object(C.h)(p);var g=s.Mc(d);if(p instanceof If)h.push(d);else{var y=Df(p,g);null!=y&&(h.push(d),l.set(d,y))}}var v=new ii(h);return new vf(l,v,s.fieldTransforms)}function Af(t,e,n,r){return void 0===r&&(r=!1),Df(n,t.Qc(r?4:3,e))}function Df(t,e){if(jf(t=Object(C.h)(t)))return Mf("Unsupported field value:",e,t),kf(t,e);if(t instanceof df)return function(t,e){if(!mf(e.xc))throw e.Bc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Bc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Oc&&4!==e.xc)throw e.Bc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Df(o[i],e.Lc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(C.h)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return bo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Yr.fromDate(t);return{timestampValue:Cs(e.R,n)}}if(t instanceof Yr)return n=new Yr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Cs(e.R,n)};if(t instanceof pf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ff)return{bytesValue:xs(e.R,t._byteString)};if(t instanceof Xl){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Bc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:As(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Bc("Unsupported field value: "+zl(t))}(t,e)}function kf(t,e){var n={};return Zr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$r(t,function(t,r){var i=Df(r,e.kc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function jf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Yr||t instanceof pf||t instanceof ff||t instanceof Xl||t instanceof df)}function Mf(t,e,n){if(!jf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=zl(n);throw e.Bc("an object"===r?t+" a custom object":t+" "+r)}}function Rf(t,e,n){if((e=Object(C.h)(e))instanceof lf)return e._internalPath;if("string"==typeof e)return Ff(t,e);throw Uf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Lf=new RegExp("[~\\*/\\[\\]]");function Ff(t,e,n){if(e.search(Lf)>=0)throw Uf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(lf.bind.apply(lf,Object(Ar.f)([void 0],e.split(".")))))._internalPath}catch(r){throw Uf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Uf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new jr(kr.INVALID_ARGUMENT,(a+=". ")+t+u)}function qf(t,e){return t.some(function(t){return t.isEqual(e)})}var Vf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Xl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Bf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Kf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Bf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Ar.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Vf);function Kf(t,e){return"string"==typeof e?Ff(t,e):e instanceof lf?e._internalPath:e._delegate._internalPath}var Gf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),zf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(Ar.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Qf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Kf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Vf),Qf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Ar.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(zf),Wf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Gf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Qf(n._firestore,n._userDataWriter,r.key,r,new Gf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new jr(kr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Qf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Gf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Qf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Gf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Hf(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Hf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Vr()}}function Yf(t,e){return t instanceof zf&&e instanceof zf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Wf&&e instanceof Wf&&t._firestore===e._firestore&&nf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Xf(t){if(ro(t)&&0===t.explicitOrderBy.length)throw new jr(kr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Jf=function(){};function $f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Zf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Wc=e,i.Gc=n,i.zc=r,i.type="where",i}return Object(Ar.c)(e,t),e.prototype._apply=function(t){var e=Of(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new jr(kr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){sd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(od(r,t,h[c]));a={arrayValue:{values:u}}}else a=od(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||sd(s,o),a=Af(n,"where",s,"in"===o||"not-in"===o);var l=Fi.create(i,o,a);return function(t,e){if(e.g()){var n=oo(t);if(null!==n&&!n.isEqual(e.field))throw new jr(kr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=io(t);null!==r&&ad(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new jr(kr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Wc,this.Gc,this.zc);return new Jl(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Jf),td=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Wc=e,r.Hc=n,r.type="orderBy",r}return Object(Ar.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new jr(kr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new jr(kr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Yi(e,n);return function(t,e){if(null===io(t)){var n=oo(t);null!==n&&ad(0,n,e.field)}}(t,r),r}(t._query,this.Wc,this.Hc);return new Jl(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Zi(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Jf),ed=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(Ar.c)(e,t),e.prototype._apply=function(t){return new Jl(t.firestore,t.converter,co(t._query,this.Jc,this.Yc))},e}(Jf),nd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Xc=n,i.Zc=r,i}return Object(Ar.c)(e,t),e.prototype._apply=function(t){var e=id(t,this.type,this.Xc,this.Zc);return new Jl(t.firestore,t.converter,function(t,e){return new Zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Jf),rd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Xc=n,i.Zc=r,i}return Object(Ar.c)(e,t),e.prototype._apply=function(t){var e=id(t,this.type,this.Xc,this.Zc);return new Jl(t.firestore,t.converter,function(t,e){return new Zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Jf);function id(t,e,n,r){if(n[0]=Object(C.h)(n[0]),n[0]instanceof Vf)return function(t,e,n,r,i){if(!r)throw new jr(kr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=ao(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Ti(e,r.key));else{var c=r.data.field(u.field);if(hi(c))throw new jr(kr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new jr(kr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Wi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Of(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new jr(kr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new jr(kr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!so(t)&&-1!==c.indexOf("/"))throw new jr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(ei.fromString(c));if(!yi.isDocumentKey(h))throw new jr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new yi(h);a.push(Ti(e,l))}else{var f=Af(n,r,c);a.push(f)}}return new Wi(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function od(t,e,n){if("string"==typeof(n=Object(C.h)(n))){if(""===n)throw new jr(kr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!so(e)&&-1!==n.indexOf("/"))throw new jr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(ei.fromString(n));if(!yi.isDocumentKey(r))throw new jr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ti(t,new yi(r))}if(n instanceof Xl)return Ti(t,n._key);throw new jr(kr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+zl(n)+".")}function sd(t,e){if(!Array.isArray(t)||0===t.length)throw new jr(kr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new jr(kr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function ad(t,e,n){if(!n.isEqual(e))throw new jr(kr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var ud=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),vi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ui(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ci(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Vr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return $r(t.fields||{},function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new pf(ui(t.latitude),ui(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=li(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(fi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=ai(t);return new Yr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=ei.fromString(t);Br(na(n));var r=new Dl(n.get(1),n.get(3)),i=new yi(n.popFirst(5));return r.isEqual(e)||Fr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function cd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var hd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Ar.c)(e,t),e.prototype.convertBytes=function(t){return new ff(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Xl(this.firestore,null,e)},e}(ud),ld=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Of(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=fd(t,this._firestore),i=cd(r.converter,e,n),o=_f(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,jo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=fd(t,this._firestore);return o="string"==typeof(e=Object(C.h)(e))||e instanceof lf?Nf(this._dataReader,"WriteBatch.update",s._key,e,n,r):Pf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,jo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=fd(t,this._firestore);return this._mutations=this._mutations.concat(new Yo(e._key,jo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new jr(kr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function fd(t,e){if((t=Object(C.h)(t)).firestore!==e)throw new jr(kr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var dd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Ar.c)(e,t),e.prototype.convertBytes=function(t){return new ff(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Xl(this.firestore,null,e)},e}(ud);function pd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Ql(t,Xl);var o=Ql(t.firestore,sf),s=Of(o);return yd(o,[("string"==typeof(e=Object(C.h)(e))||e instanceof lf?Nf(s,"updateDoc",t._key,e,n,r):Pf(s,"updateDoc",t._key,e)).toMutation(t._key,jo.exists(!0))])}function gd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(C.h)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||of(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(of(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Xl)c=Ql(t.firestore,sf),h=eo(t._key.path),u={next:function(e){i[a]&&i[a](vd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Ql(t,Jl);c=Ql(d.firestore,sf),h=d._query;var p=new dd(c);u={next:function(t){i[a]&&i[a](new Wf(c,p,d,t))},error:i[a+1],complete:i[a+2]},Xf(t._query)}return function(t,e,n,r){var i=this,o=new yl(r),s=new Sh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(i,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:return e=Oh,[4,xl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(i,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:return e=_h,[4,xl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(af(c),h,l,u)}function yd(t,e){return function(t,e){var n=this,r=new Sa;return t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(n,void 0,void 0,function(){var n;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return n=Fh,[4,Cl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(af(t),e)}function vd(t,e,n){var r=n.docs.get(e._key),i=new dd(t);return new zf(t,i,e._key,r,new Gf(n.hasPendingWrites,n.fromCache),e.converter)}var md=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(Ar.c)(e,t),e.prototype.get=function(e){var n=this,r=fd(e,this._firestore),i=new dd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new zf(n._firestore,i,r._key,t._document,new Gf(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Of(t)}return t.prototype.get=function(t){var e=this,n=fd(t,this._firestore),r=new hd(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Vr();var i=t[0];if(i.isFoundDocument())return new Vf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Vf(e._firestore,r,n._key,null,n.converter);throw Vr()})},t.prototype.set=function(t,e,n){var r=fd(t,this._firestore),i=cd(r.converter,e,n),o=_f(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=fd(t,this._firestore);return o="string"==typeof(e=Object(C.h)(e))||e instanceof lf?Nf(this._dataReader,"Transaction.update",s._key,e,n,r):Pf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=fd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function bd(){if("undefined"==typeof Uint8Array)throw new jr(kr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function wd(){if("undefined"==typeof atob)throw new jr(kr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Od=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return wd(),new t(ff.fromBase64String(e))},t.fromUint8Array=function(e){return bd(),new t(ff.fromUint8Array(e))},t.prototype.toBase64=function(){return wd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return bd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),_d=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){hf(t=Ql(t,sf));var n=af(t),r=t._freezeSettings(),i=new gl;return cf(n,i,new dl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){hf(t=Ql(t,sf));var e=af(t),n=t._freezeSettings(),r=new gl;return cf(e,r,new pl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new jr(kr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Sa;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Ar.b)(e,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(Ar.b)(this,void 0,void 0,function(){return Object(Ar.d)(this,function(e){switch(e.label){case 0:return Pa.yt()?[4,Pa.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(qu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Id=function(){function t(t,e,n){var r=this;this._delegate=e,this.ta=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Dl||(this.ea=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=Ql(t,Yl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Ur("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=Object(C.d)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new jr(kr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Rl(new jl(o,new vc(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Ar.b)(e,void 0,void 0,function(){var e,n;return Object(Ar.d)(this,function(r){switch(r.label){case 0:return[4,Tl(t)];case 1:return e=r.sent(),[4,Sl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Kr(t);return e.$r.delete(0),Kc(e)}(n))]}})})})}(af(Ql(this._delegate,sf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Ar.b)(e,void 0,void 0,function(){var e,n;return Object(Ar.d)(this,function(r){switch(r.label){case 0:return[4,Tl(t)];case 1:return e=r.sent(),[4,Sl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(Ar.b)(this,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:return(e=Kr(t)).$r.add(0),[4,Gc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(af(Ql(this._delegate,sf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Bl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.ta.enableMultiTabIndexedDbPersistence(this):this.ta.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.ta.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.ea&&(this.ea._removeServiceInstance("firestore"),this.ea._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Sa;return t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(e,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(r){switch(r.label){case 0:return e=Gh,[4,Cl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(af(Ql(this._delegate,sf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new yl(e);return t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(n,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Kr(t).Gr.add(e),e.next()},[4,xl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(n,void 0,void 0,function(){var e;return Object(Ar.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Kr(t).Gr.delete(e)},[4,xl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(af(t=Ql(t,sf)),of(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.ea)throw new jr(kr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.ea},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Ld(this,Zl(this._delegate,t))}catch(t){throw Pd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new xd(this,tf(this._delegate,t))}catch(t){throw Pd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new jd(this,function(t,e){if(t=Ql(t,Yl),ql("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new jr(kr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Jl(t,null,function(t){return new Zi(ei.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Pd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Sa;return t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(n,void 0,void 0,function(){var n;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return Il(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new ml(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(af(t),function(n){return e(new md(t,n))})}(this._delegate,function(n){return t(new Ed(e,n))})},t.prototype.batch=function(){var t=this;return af(this._delegate),new Sd(new ld(this._delegate,function(e){return yd(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new jr(kr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new jr(kr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Td=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Ar.c)(e,t),e.prototype.convertBytes=function(t){return new Od(new ff(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return xd.na(e,this.firestore,null)},e}(ud),Ed=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Td(t)}return t.prototype.get=function(t){var e=this,n=Fd(t);return this._delegate.get(n).then(function(t){return new Dd(e._firestore,new zf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=Fd(t);return n?(Vl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Fd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Ar.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Fd(t);return this._delegate.delete(e),this},t}(),Sd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Fd(t);return n?(Vl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Fd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Ar.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Fd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Cd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Qf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new kd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.sa=function(e,n){var r=t.ia,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Td(e),n),i.set(n,o)),o},t}();Cd.ia=new WeakMap;var xd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Td(t)}return t.ra=function(e,n,r){if(e.length%2!=0)throw new jr(kr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Xl(n._delegate,r,new yi(e)))},t.na=function(e,n,r){return new t(n,new Xl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Ld(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Ld(this.firestore,Zl(this._delegate,t))}catch(t){throw Pd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(C.h)(t))instanceof Xl&&ef(this._delegate,t)},t.prototype.set=function(t,e){e=Vl("DocumentReference.set",e);try{return function(t,e,n){t=Ql(t,Xl);var r=Ql(t.firestore,sf),i=cd(t.converter,e,n);return yd(r,[_f(Of(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,jo.none())])}(this._delegate,t,e)}catch(t){throw Pd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?pd(this._delegate,t):pd.apply(void 0,Object(Ar.f)([this._delegate,t,e],n))}catch(t){throw Pd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return yd(Ql((t=this._delegate).firestore,sf),[new Yo(t._key,jo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Nd(e),i=Ad(e,function(e){return new Dd(t.firestore,new zf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return gd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ql(t,Xl);var e=Ql(t.firestore,sf),n=af(e),r=new dd(e);return function(t,e){var n=this,r=new Sa;return t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(n,void 0,void 0,function(){var n;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r,i;return Object(Ar.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Kr(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new jr(kr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=gh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,El(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new zf(e,r,t._key,n,new Gf(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ql(t,Xl);var e=Ql(t.firestore,sf);return Pl(af(e),t._key,{source:"server"}).then(function(n){return vd(e,t,n)})}(this._delegate):function(t){t=Ql(t,Xl);var e=Ql(t.firestore,sf);return Pl(af(e),t._key).then(function(n){return vd(e,t,n)})}(this._delegate)).then(function(t){return new Dd(e.firestore,new zf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Cd.sa(this.firestore,e):null))},t}();function Pd(t,e,n){return t.message=t.message.replace(e,n),t}function Nd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!of(r))return r}return{}}function Ad(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=of(t[0])?t[0]:of(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Dd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new xd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Yf(this._delegate,t._delegate)},t}(),kd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Ar.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Dd),jd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Td(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,$f(this._delegate,function(t,e,n){var r=e,i=Kf("where",t);return new Zf(i,r,n)}(e,n,r)))}catch(e){throw Pd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,$f(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Kf("orderBy",t);return new td(r,n)}(e,n)))}catch(e){throw Pd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,$f(this._delegate,function(t){return Wl("limit",t),new ed("limit",t,"F")}(e)))}catch(e){throw Pd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,$f(this._delegate,function(t){return Wl("limitToLast",t),new ed("limitToLast",t,"L")}(e)))}catch(e){throw Pd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,$f(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new nd("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw Pd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,$f(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new nd("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw Pd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,$f(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new rd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw Pd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,$f(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new rd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw Pd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return nf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ql(t,Jl);var e=Ql(t.firestore,sf),n=af(e),r=new dd(e);return function(t,e){var n=this,r=new Sa;return t.asyncQueue.enqueueAndForget(function(){return Object(Ar.b)(n,void 0,void 0,function(){var n;return Object(Ar.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Ar.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(Ar.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,ec(t,e,!0)];case 1:return a=u.sent(),r=new Ah(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=gh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,El(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new Wf(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ql(t,Jl);var e=Ql(t.firestore,sf),n=af(e),r=new dd(e);return Nl(n,t._query,{source:"server"}).then(function(n){return new Wf(e,r,t,n)})}(this._delegate):function(t){t=Ql(t,Jl);var e=Ql(t.firestore,sf),n=af(e),r=new dd(e);return Xf(t._query),Nl(n,t._query).then(function(n){return new Wf(e,r,t,n)})}(this._delegate)).then(function(t){return new Rd(e.firestore,new Wf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Nd(e),i=Ad(e,function(e){return new Rd(t.firestore,new Wf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return gd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Cd.sa(this.firestore,e):null))},t}(),Md=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new kd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Rd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new jd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new kd(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Md(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new kd(n._firestore,r))})},t.prototype.isEqual=function(t){return Yf(this._delegate,t._delegate)},t}(),Ld=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(Ar.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new xd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new xd(this.firestore,void 0===t?tf(this._delegate):tf(this._delegate,t))}catch(t){throw Pd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Ql(t.firestore,sf),r=tf(t),i=cd(t.converter,e);return yd(n,[_f(Of(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,jo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new xd(e.firestore,t)})},e.prototype.isEqual=function(t){return ef(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Cd.sa(this.firestore,t):null))},e}(jd);function Fd(t){return Ql(t,Xl)}var Ud,qd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(lf.bind.apply(lf,Object(Ar.f)([void 0],t)))}return t.documentId=function(){return new t(ri.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(C.h)(t))instanceof lf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Vd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Ef("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new If("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Sf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Cf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new xf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Bd=n("/6Yf"),Kd={Firestore:Id,GeoPoint:pf,Timestamp:Yr,Blob:Od,Transaction:Ed,WriteBatch:Sd,DocumentReference:xd,DocumentSnapshot:Dd,Query:jd,QueryDocumentSnapshot:kd,QuerySnapshot:Rd,CollectionReference:Ld,FieldPath:qd,FieldValue:Vd,setLogLevel:function(t){Mr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Bd.a("firestore",function(t){return function(t,e){return new Id(t,new sf(t,e),new _d)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Kd)))})(Ud=S.a),Ud.registerVersion("@firebase/firestore","2.3.1");var Gd=n("XNiG"),zd=n("VRyK"),Qd=n("eIep"),Wd=n("qgXg"),Hd=n("quSY"),Yd=n("9ppp"),Xd=n("Ylt2");class Jd extends Gd.a{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n){super(),this.scheduler=n,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new $d(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,n=e?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;let o;if(this.closed)throw new Yd.a;if(this.isStopped||this.hasError?o=Hd.a.EMPTY:(this.observers.push(t),o=new Xd.a(this,t)),r&&t.add(t=new I.a(t,r)),e)for(let s=0;s<i&&!t.closed;s++)t.next(n[s]);else for(let s=0;s<i&&!t.closed;s++)t.next(n[s].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),o}_getNow(){return(this.scheduler||Wd.a).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length;let o=0;for(;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r}}class $d{constructor(t,e){this.time=t,this.value=e}}function Zd(t,e,n){let r;return r=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},t=>t.lift(function({bufferSize:t=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:n,scheduler:r}){let i,o,s=0,a=!1,u=!1;return function(c){let h;s++,!i||a?(a=!1,i=new Jd(t,e,r),h=i.subscribe(this),o=c.subscribe({next(t){i.next(t)},error(t){a=!0,i.error(t)},complete(){u=!0,o=void 0,i.complete()}}),u&&(o=void 0)):h=i.subscribe(this),this.add(()=>{s--,h.unsubscribe(),h=void 0,o&&!u&&n&&0===s&&(o.unsubscribe(),o=void 0,i=void 0)})}}(r))}var tp=n("SxV6");function ep(t,e){return e?Object(Qd.a)(()=>t,e):Object(Qd.a)(()=>t)}var np=n("tf+s");const rp=new s.q("angularfire2.auth.use-emulator"),ip=new s.q("angularfire2.auth.settings"),op=new s.q("angularfire2.auth.tenant-id"),sp=new s.q("angularfire2.auth.langugage-code"),ap=new s.q("angularfire2.auth.use-device-language"),up=new s.q("angularfire.auth.persistence");let cp=(()=>{class t{constructor(t,e,i,o,s,a,u,c,d,p){const g=new T.d(o),y=Object(T.h)(g),v=new Gd.a,b=Object(f.a)(void 0).pipe(Object(I.b)(g.outsideAngular),Object(Qd.a)(()=>o.runOutsideAngular(()=>n.e(19).then(n.bind(null,"6nsN")))),Object(m.a)(()=>Object(T.g)(t,o,e)),Object(m.a)(t=>o.runOutsideAngular(()=>{const e=s,n=a;return Object(T.f)(t.name+".auth","AngularFireAuth",t,()=>{const r=o.runOutsideAngular(()=>t.auth());if(e&&r.useEmulator("http://"+e.join(":")),u&&(r.tenantId=u),r.languageCode=c,d&&r.useDeviceLanguage(),n)for(const[t,e]of Object.entries(n))r.settings[t]=e;return p&&r.setPersistence(p),r},[e,u,c,d,n,p])})),Zd({bufferSize:1,refCount:!1}));if(Object(r.n)(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Object(f.a)(null);else{b.pipe(Object(tp.a)()).subscribe();const t=b.pipe(Object(Qd.a)(t=>t.getRedirectResult().then(t=>t,()=>null)),y,Zd({bufferSize:1,refCount:!1})),e=t=>new h.a(e=>({unsubscribe:o.runOutsideAngular(()=>t(e))})),n=b.pipe(Object(Qd.a)(t=>e(t.onAuthStateChanged.bind(t)))),r=b.pipe(Object(Qd.a)(t=>e(t.onIdTokenChanged.bind(t))));this.authState=t.pipe(ep(n),Object(np.a)(g.outsideAngular),Object(I.b)(g.insideAngular)),this.user=t.pipe(ep(r),Object(np.a)(g.outsideAngular),Object(I.b)(g.insideAngular)),this.idToken=this.user.pipe(Object(Qd.a)(t=>t?Object(l.a)(t.getIdToken()):Object(f.a)(null))),this.idTokenResult=this.user.pipe(Object(Qd.a)(t=>t?Object(l.a)(t.getIdTokenResult()):Object(f.a)(null))),this.credential=Object(zd.a)(t,v,this.authState.pipe(Object(_.a)(t=>!t))).pipe(Object(m.a)(t=>(null==t?void 0:t.user)?t:null),Object(np.a)(g.outsideAngular),Object(I.b)(g.insideAngular))}return Object(T.i)(this,b,o,{spy:{apply:(t,e,n)=>{(t.startsWith("signIn")||t.startsWith("createUser"))&&n.then(t=>v.next(t))}}})}}return t.\u0275fac=function(e){return new(e||t)(s.Pb(T.c),s.Pb(T.b,8),s.Pb(s.B),s.Pb(s.z),s.Pb(rp,8),s.Pb(ip,8),s.Pb(op,8),s.Pb(sp,8),s.Pb(ap,8),s.Pb(up,8))},t.\u0275prov=s.Eb({factory:function(){return new t(s.Pb(T.c),s.Pb(T.b,8),s.Pb(s.B),s.Pb(s.z),s.Pb(rp,8),s.Pb(ip,8),s.Pb(op,8),s.Pb(sp,8),s.Pb(ap,8),s.Pb(up,8))},token:t,providedIn:"any"}),t})();function hp(t,e){return function(t,e=c.a){return new h.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function lp(t,e){return hp(t,e).pipe(Object(m.a)(t=>({payload:t,type:"query"})))}function fp(t,e){return lp(t,e).pipe(Object(d.a)(void 0),g(),Object(m.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function dp(t,e,n){return fp(t,n).pipe(Object(b.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return pp(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return pp(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return pp(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),t=>t.lift(new w(void 0,void 0)),Object(m.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function pp(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function gp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}Object(T.e)(cp,[{app:null,applyActionCode:null,checkActionCode:null,confirmPasswordReset:null,createUserWithEmailAndPassword:null,currentUser:null,fetchSignInMethodsForEmail:null,isSignInWithEmailLink:null,getRedirectResult:null,languageCode:null,settings:null,onAuthStateChanged:null,onIdTokenChanged:null,sendSignInLinkToEmail:null,sendPasswordResetEmail:null,setPersistence:null,signInAndRetrieveDataWithCredential:null,signInAnonymously:null,signInWithCredential:null,signInWithCustomToken:null,signInWithEmailAndPassword:null,signInWithPhoneNumber:null,signInWithEmailLink:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,tenantId:null,updateCurrentUser:null,useDeviceLanguage:null,useEmulator:null,verifyPasswordResetCode:null}]);class yp{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=fp(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(m.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(d.a)(void 0),g(),Object(_.a)(([t,e])=>e.length>0||!t),Object(m.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(b.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=gp(t);return dp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return lp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(m.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(l.a)(this.query.get(t)).pipe(Object(I.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new vp(this.ref.doc(t),this.afs)}}class vp{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=Ip(n,e);return new yp(r,i,this.afs)}snapshotChanges(){return hp(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(d.a)(void 0),g(),Object(m.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(m.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(l.a)(this.ref.get(t)).pipe(Object(I.b)(this.afs.schedulers.insideAngular))}}class mp{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?fp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(m.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(_.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):fp(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(b.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=gp(t);return dp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return lp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(m.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(l.a)(this.query.get(t)).pipe(Object(I.b)(this.afs.schedulers.insideAngular))}}const bp=new s.q("angularfire2.enableFirestorePersistence"),wp=new s.q("angularfire2.firestore.persistenceSettings"),Op=new s.q("angularfire2.firestore.settings"),_p=new s.q("angularfire2.firestore.use-emulator");function Ip(t,e=(t=>t)){return{query:e(t),ref:t}}let Tp=(()=>{class t{constructor(t,e,n,i,o,s,a,u,c){this.schedulers=new T.d(s),this.keepUnstableUntilFirst=Object(T.h)(this.schedulers);const h=Object(T.g)(t,s,e);!E.a.auth&&c&&Object(T.j)();const d=u;[this.firestore,this.persistenceEnabled$]=Object(T.f)(h.name+".firestore","AngularFirestore",h,()=>{const t=s.runOutsideAngular(()=>h.firestore());if(i&&t.settings(i),d&&t.useEmulator(...d),n&&!Object(r.n)(o)){const e=()=>{try{return Object(l.a)(t.enablePersistence(a||void 0).then(()=>!0,()=>!1))}catch(Ud){return"undefined"!=typeof console&&console.warn(Ud),Object(f.a)(!1)}};return[t,s.runOutsideAngular(e)]}return[t,Object(f.a)(!1)]},[i,d,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=Ip(n,e),o=this.schedulers.ngZone.run(()=>r);return new yp(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new mp(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new vp(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(s.Pb(T.c),s.Pb(T.b,8),s.Pb(bp,8),s.Pb(Op,8),s.Pb(s.B),s.Pb(s.z),s.Pb(wp,8),s.Pb(_p,8),s.Pb(rp,8))},t.\u0275prov=s.Eb({factory:function(){return new t(s.Pb(T.c),s.Pb(T.b,8),s.Pb(bp,8),s.Pb(Op,8),s.Pb(s.B),s.Pb(s.z),s.Pb(wp,8),s.Pb(_p,8),s.Pb(rp,8))},token:t,providedIn:"any"}),t})();var Ep=n("AtUx");let Sp=(()=>{class t{constructor(t,e,n){this.config=t,this.firestore=e,this.loader=n}post(t,e){return this.firestore.collection(t).doc().set(e)}getAll(t){let e=[];return this.firestore.collection(t).get().subscribe(t=>{t.docs.forEach(t=>{e.push(Object.assign({id:t.id},t.data()))})}),e}getSingle(t,e){return this.firestore.collection(t).doc(e).get()}put(t,e,n){return this.firestore.collection(t).doc(e).update(n)}delete(t,e){return this.firestore.collection(t).doc(e).delete()}}return t.\u0275fac=function(e){return new(e||t)(s.Pb(u),s.Pb(Tp),s.Pb(Ep.a))},t.\u0275prov=s.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Cp(t,e){if(1&t){const t=s.Mb();s.Lb(0,"tr"),s.Lb(1,"td"),s.gc(2),s.Kb(),s.Lb(3,"td"),s.Lb(4,"a",8),s.Sb("click",function(){s.bc(t);const n=e.$implicit;return s.Ub().edit(n)}),s.Kb(),s.Lb(5,"a",9),s.Sb("click",function(){s.bc(t);const n=e.$implicit;return s.Ub().deleteCategory(n.id)}),s.Kb(),s.Kb(),s.Kb()}if(2&t){const t=e.$implicit;s.yb(2),s.hc(t.name)}}let xp=(()=>{class t{constructor(t,e,n){this.router=t,this.config=e,this.api=n,this.data=[]}ngOnInit(){this.getCategories()}getCategories(){this.data=this.api.getAll(this.config.collections.categories_table)}edit(t){this.router.navigate(["/categories/add-category"],{state:t})}deleteCategory(t){this.api.delete(this.config.collections.categories_table,t).then(()=>{console.log("deleted successfully"),this.getCategories()}).catch(t=>{alert(t)})}}return t.\u0275fac=function(e){return new(e||t)(s.Ib(o.a),s.Ib(u),s.Ib(Sp))},t.\u0275cmp=s.Cb({type:t,selectors:[["app-category-listing"]],decls:17,vars:1,consts:[[1,"category-listing"],[1,"container"],[1,"row"],[1,"col-12"],[1,"heading"],[1,"table"],["scope","col"],[4,"ngFor","ngForOf"],[1,"far","fa-edit","mr-4",3,"click"],[1,"fas","fa-trash-alt",3,"click"]],template:function(t,e){1&t&&(s.Lb(0,"div",0),s.Lb(1,"div",1),s.Lb(2,"div",2),s.Lb(3,"div",3),s.Lb(4,"div",4),s.Lb(5,"h1"),s.gc(6,"Category Listing"),s.Kb(),s.Kb(),s.Kb(),s.Lb(7,"div",3),s.Lb(8,"table",5),s.Lb(9,"thead"),s.Lb(10,"tr"),s.Lb(11,"th",6),s.gc(12,"Category Name"),s.Kb(),s.Lb(13,"th",6),s.gc(14,"Actions"),s.Kb(),s.Kb(),s.Kb(),s.Lb(15,"tbody"),s.fc(16,Cp,6,1,"tr",7),s.Kb(),s.Kb(),s.Kb(),s.Kb(),s.Kb(),s.Kb()),2&t&&(s.yb(16),s.Vb("ngForOf",e.data))},directives:[r.i],styles:['@import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,500;0,700;0,900;1,800&display=swap");.c-btn[_ngcontent-%COMP%]{padding:10px 30px;color:#fff;border:0;font-size:16px;cursor:pointer;font-weight:500;border-radius:7px;text-align:center}.c-btn.green[_ngcontent-%COMP%]{background:linear-gradient(270deg,#76e672,#41c83e);box-shadow:0 5px 12px 0 rgba(68,202,65,.35)}.c-btn.pink[_ngcontent-%COMP%]{background:linear-gradient(77deg,#f5286e,#fc6d43);box-shadow:0 5px 12px 0 rgba(245,40,110,.35)}.c-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:7px}.bg-pink-gradient[_ngcontent-%COMP%]{background:linear-gradient(77deg,#f5286e,#fc6d43)}.bg-green-gradient[_ngcontent-%COMP%]{background:linear-gradient(270deg,#76e672,#41c83e)}.text-pinkgradient[_ngcontent-%COMP%]{background:linear-gradient(77deg,#f5286e,#fc6d43);-webkit-background-clip:text;-webkit-text-fill-color:transparent}body[_ngcontent-%COMP%]{overflow-x:hidden!important;font-family:Montserrat,sans-serif!important}body[_ngcontent-%COMP%], h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%], p[_ngcontent-%COMP%], ul[_ngcontent-%COMP%]{margin:0}a[_ngcontent-%COMP%]{text-decoration:none}.input-box[_ngcontent-%COMP%]{border:1px solid #e7e7e7;padding:10px;font-size:15px;width:100%;border-radius:5px}.form-control[_ngcontent-%COMP%]{font-size:15px;border:1px solid #e7e7e7!important;height:45px}.uneditable-input[_ngcontent-%COMP%]:focus, input[type=color][_ngcontent-%COMP%]:focus, input[type=date][_ngcontent-%COMP%]:focus, input[type=datetime-local][_ngcontent-%COMP%]:focus, input[type=datetime][_ngcontent-%COMP%]:focus, input[type=email][_ngcontent-%COMP%]:focus, input[type=month][_ngcontent-%COMP%]:focus, input[type=number][_ngcontent-%COMP%]:focus, input[type=password][_ngcontent-%COMP%]:focus, input[type=search][_ngcontent-%COMP%]:focus, input[type=tel][_ngcontent-%COMP%]:focus, input[type=text][_ngcontent-%COMP%]:focus, input[type=time][_ngcontent-%COMP%]:focus, input[type=url][_ngcontent-%COMP%]:focus, input[type=week][_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]:focus{border-color:none;box-shadow:none;outline:0 none}.form-control[_ngcontent-%COMP%]:focus{border-color:none;outline:0;box-shadow:none}.main-header-space[_ngcontent-%COMP%]{position:relative;top:55px}.loading[_ngcontent-%COMP%]{width:200px}.loading[_ngcontent-%COMP%], .no-data[_ngcontent-%COMP%]{display:block;margin:auto}.no-data[_ngcontent-%COMP%]{width:150px}.content-loading[_ngcontent-%COMP%]{width:300px;display:block;margin:auto}.disable-opacity[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.back-btn[_ngcontent-%COMP%]{position:fixed;top:20px;left:15px;background:hsla(0,0%,80%,.1607843137254902);padding:5px 20px;color:#000;border-radius:25px}.plain-card[_ngcontent-%COMP%]{padding:25px}.admin-card[_ngcontent-%COMP%], .plain-card[_ngcontent-%COMP%]{border-radius:7px;border:none;box-shadow:0 5px 15px rgba(0,0,0,.1)}.admin-card[_ngcontent-%COMP%]{padding:15px}.custom-dropdown[_ngcontent-%COMP%]{position:relative;width:100%;height:80px;box-shadow:0 5px 15px 0 rgba(144,147,151,.2);border-radius:7px;background-color:#fff;border:0;padding:25px 30px;font-size:20px;letter-spacing:.1px;color:#1e1f22}.custom-dropdown[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;color:#1e1f22}.custom-dropdown[_ngcontent-%COMP%]   i.arrow[_ngcontent-%COMP%]{position:absolute;top:30px;right:20px}.custom-dropdown[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer}.custom-dropdown[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]{position:absolute;width:100%;left:0;top:100%;background:#fff;border-radius:7px;box-shadow:0 5px 15px 0 rgba(144,147,151,.2);display:none;z-index:1}.custom-dropdown[_ngcontent-%COMP%]   .options.show[_ngcontent-%COMP%]{display:block}.custom-dropdown[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.custom-dropdown[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{cursor:pointer;padding:10px}.custom-dropdown[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background:#ccc}.all-center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}button[_ngcontent-%COMP%]:focus{border-color:none;box-shadow:none;outline:0 none}.category-listing[_ngcontent-%COMP%]{padding:4% 0}.category-listing[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{padding-bottom:3%}.category-listing[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#000;font-weight:600;font-size:25px;letter-spacing:.1px}@media only screen and (max-width:600px){.category-listing[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:5%}}.category-listing[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:pointer;font-size:16px}.category-listing[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   a.fa-edit[_ngcontent-%COMP%]{color:green}.category-listing[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   a.fa-trash-alt[_ngcontent-%COMP%]{color:red}']}),t})();function Pp(t,e){if(1&t&&s.Jb(0,"img",21),2&t){const t=s.Ub();s.Wb("src",t.categoryPreview,s.cc)}}const Np=function(t){return{"disable-opacity":t}};function Ap(t,e){if(1&t){const t=s.Mb();s.Lb(0,"button",22),s.Sb("click",function(){return s.bc(t),s.Ub().createCategory()}),s.gc(1," Add Category "),s.Kb()}if(2&t){const t=s.Ub();s.Vb("disabled",t.programForm.invalid)("ngClass",s.Xb(2,Np,t.programForm.invalid))}}function Dp(t,e){if(1&t){const t=s.Mb();s.Lb(0,"button",23),s.Sb("click",function(){return s.bc(t),s.Ub().updateCategory()}),s.gc(1," Update Category "),s.Kb()}if(2&t){const t=s.Ub();s.Vb("disabled",t.programForm.invalid)("ngClass",s.Xb(2,Np,t.programForm.invalid))}}function kp(t,e){if(1&t&&s.Jb(0,"img",21),2&t){const t=s.Ub();s.Wb("src",t.topicPreview,s.cc)}}const jp=[{path:"",component:a,children:[{path:"",component:xp},{path:"category-listing",component:xp},{path:"add-category",component:(()=>{class t{constructor(t,e,n,r){this.fb=t,this.router=e,this.config=n,this.api=r,this.categoryPreview="assets/img/img-upload-icon.png",this.categoryImageUploaded=!1,this.topicPreview="assets/img/img-upload-icon.png",this.topicImageUploaded=!1,this.programForm=i.e,this.editObj={},this.isEdit=!1,this.editObj=this.router.getCurrentNavigation().extras.state}ngOnInit(){this.formInit(),this.editObj&&(this.programForm.patchValue({categoryName:this.editObj.name}),this.isEdit=!0)}formInit(){this.programForm=this.fb.group({categoryName:["",i.m.required]})}createCategory(){this.api.post(this.config.collections.categories_table,{name:this.programForm.value.categoryName}).then(()=>{this.programForm.reset(),this.router.navigateByUrl("/categories/category-listing")}).catch(t=>{alert(t)})}updateCategory(t){this.api.put(this.config.collections.categories_table,this.editObj.id,{name:this.programForm.value.categoryName}).then(()=>{this.programForm.reset(),this.router.navigateByUrl("/categories/category-listing")}).catch(t=>{alert(t)})}categoryReadURL(t){if(t.target.files&&t.target.files[0]){const e=t.target.files[0],n=new FileReader;n.onload=t=>this.categoryPreview=n.result,n.readAsDataURL(e)}}topicReadURL(t){if(t.target.files&&t.target.files[0]){const e=t.target.files[0],n=new FileReader;n.onload=t=>this.topicPreview=n.result,n.readAsDataURL(e)}}}return t.\u0275fac=function(e){return new(e||t)(s.Ib(i.c),s.Ib(o.a),s.Ib(u),s.Ib(Sp))},t.\u0275cmp=s.Cb({type:t,selectors:[["app-add-category"]],decls:39,vars:6,consts:[[1,"add-category"],[1,"container"],[1,"row","justify-content-center"],[1,"col-12","col-md-6","col-lg-6"],[1,"plain-card"],[1,"col-12","col-md-12","col-lg-12"],[1,"heading"],[1,"add-img"],["type","file","accept","image/*",1,"d-none",3,"change"],["file",""],[3,"click"],[3,"src",4,"ngIf"],[3,"formGroup"],[1,"form-group","pt-4"],["type","text","placeholder","Category Name","formControlName","categoryName",1,"form-control"],[1,"add-btn"],["class","c-btn pink mr-3",3,"disabled","ngClass","click",4,"ngIf"],["class","c-btn green",3,"disabled","ngClass","click",4,"ngIf"],["file1",""],["type","text","placeholder","Topic Name",1,"form-control"],[1,"c-btn","pink"],[3,"src"],[1,"c-btn","pink","mr-3",3,"disabled","ngClass","click"],[1,"c-btn","green",3,"disabled","ngClass","click"]],template:function(t,e){if(1&t){const t=s.Mb();s.Lb(0,"div",0),s.Lb(1,"div",1),s.Lb(2,"div",2),s.Lb(3,"div",3),s.Lb(4,"div",4),s.Lb(5,"div",5),s.Lb(6,"div",6),s.Lb(7,"h1"),s.gc(8),s.Kb(),s.Kb(),s.Kb(),s.Lb(9,"div",5),s.Lb(10,"div",7),s.Lb(11,"input",8,9),s.Sb("change",function(t){return e.categoryReadURL(t)}),s.Kb(),s.Lb(13,"a",10),s.Sb("click",function(){return s.bc(t),s.ac(12).click()}),s.fc(14,Pp,1,1,"img",11),s.Kb(),s.Kb(),s.Lb(15,"form",12),s.Lb(16,"div",13),s.Jb(17,"input",14),s.Kb(),s.Lb(18,"div",15),s.fc(19,Ap,2,4,"button",16),s.fc(20,Dp,2,4,"button",17),s.Kb(),s.Kb(),s.Kb(),s.Kb(),s.Kb(),s.Lb(21,"div",3),s.Lb(22,"div",4),s.Lb(23,"div",5),s.Lb(24,"div",6),s.Lb(25,"h1"),s.gc(26,"Add A Topic"),s.Kb(),s.Kb(),s.Kb(),s.Lb(27,"div",5),s.Lb(28,"div",7),s.Lb(29,"input",8,18),s.Sb("change",function(t){return e.topicReadURL(t)}),s.Kb(),s.Lb(31,"a",10),s.Sb("click",function(){return s.bc(t),s.ac(30).click()}),s.fc(32,kp,1,1,"img",11),s.Kb(),s.Kb(),s.Lb(33,"form"),s.Lb(34,"div",13),s.Jb(35,"input",19),s.Kb(),s.Lb(36,"div",15),s.Lb(37,"button",20),s.gc(38,"Add Topic"),s.Kb(),s.Kb(),s.Kb(),s.Kb(),s.Kb(),s.Kb(),s.Kb(),s.Kb(),s.Kb()}2&t&&(s.yb(8),s.ic("",e.isEdit?"Edit":"Add"," Category"),s.yb(6),s.Vb("ngIf",!e.categoryImageUploaded),s.yb(1),s.Vb("formGroup",e.programForm),s.yb(4),s.Vb("ngIf",!e.isEdit),s.yb(1),s.Vb("ngIf",e.isEdit),s.yb(12),s.Vb("ngIf",!e.topicImageUploaded))},directives:[r.j,i.n,i.i,i.f,i.b,i.h,i.d,i.j,r.h],styles:['@import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,500;0,700;0,900;1,800&display=swap");.c-btn[_ngcontent-%COMP%]{padding:10px 30px;color:#fff;border:0;font-size:16px;cursor:pointer;font-weight:500;border-radius:7px;text-align:center}.c-btn.green[_ngcontent-%COMP%]{background:linear-gradient(270deg,#76e672,#41c83e);box-shadow:0 5px 12px 0 rgba(68,202,65,.35)}.c-btn.pink[_ngcontent-%COMP%]{background:linear-gradient(77deg,#f5286e,#fc6d43);box-shadow:0 5px 12px 0 rgba(245,40,110,.35)}.c-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:7px}.bg-pink-gradient[_ngcontent-%COMP%]{background:linear-gradient(77deg,#f5286e,#fc6d43)}.bg-green-gradient[_ngcontent-%COMP%]{background:linear-gradient(270deg,#76e672,#41c83e)}.text-pinkgradient[_ngcontent-%COMP%]{background:linear-gradient(77deg,#f5286e,#fc6d43);-webkit-background-clip:text;-webkit-text-fill-color:transparent}body[_ngcontent-%COMP%]{overflow-x:hidden!important;font-family:Montserrat,sans-serif!important}body[_ngcontent-%COMP%], h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%], p[_ngcontent-%COMP%], ul[_ngcontent-%COMP%]{margin:0}a[_ngcontent-%COMP%]{text-decoration:none}.input-box[_ngcontent-%COMP%]{border:1px solid #e7e7e7;padding:10px;font-size:15px;width:100%;border-radius:5px}.form-control[_ngcontent-%COMP%]{font-size:15px;border:1px solid #e7e7e7!important;height:45px}.uneditable-input[_ngcontent-%COMP%]:focus, input[type=color][_ngcontent-%COMP%]:focus, input[type=date][_ngcontent-%COMP%]:focus, input[type=datetime-local][_ngcontent-%COMP%]:focus, input[type=datetime][_ngcontent-%COMP%]:focus, input[type=email][_ngcontent-%COMP%]:focus, input[type=month][_ngcontent-%COMP%]:focus, input[type=number][_ngcontent-%COMP%]:focus, input[type=password][_ngcontent-%COMP%]:focus, input[type=search][_ngcontent-%COMP%]:focus, input[type=tel][_ngcontent-%COMP%]:focus, input[type=text][_ngcontent-%COMP%]:focus, input[type=time][_ngcontent-%COMP%]:focus, input[type=url][_ngcontent-%COMP%]:focus, input[type=week][_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]:focus{border-color:none;box-shadow:none;outline:0 none}.form-control[_ngcontent-%COMP%]:focus{border-color:none;outline:0;box-shadow:none}.main-header-space[_ngcontent-%COMP%]{position:relative;top:55px}.loading[_ngcontent-%COMP%]{width:200px}.loading[_ngcontent-%COMP%], .no-data[_ngcontent-%COMP%]{display:block;margin:auto}.no-data[_ngcontent-%COMP%]{width:150px}.content-loading[_ngcontent-%COMP%]{width:300px;display:block;margin:auto}.disable-opacity[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.back-btn[_ngcontent-%COMP%]{position:fixed;top:20px;left:15px;background:hsla(0,0%,80%,.1607843137254902);padding:5px 20px;color:#000;border-radius:25px}.plain-card[_ngcontent-%COMP%]{padding:25px}.admin-card[_ngcontent-%COMP%], .plain-card[_ngcontent-%COMP%]{border-radius:7px;border:none;box-shadow:0 5px 15px rgba(0,0,0,.1)}.admin-card[_ngcontent-%COMP%]{padding:15px}.custom-dropdown[_ngcontent-%COMP%]{position:relative;width:100%;height:80px;box-shadow:0 5px 15px 0 rgba(144,147,151,.2);border-radius:7px;background-color:#fff;border:0;padding:25px 30px;font-size:20px;letter-spacing:.1px;color:#1e1f22}.custom-dropdown[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;color:#1e1f22}.custom-dropdown[_ngcontent-%COMP%]   i.arrow[_ngcontent-%COMP%]{position:absolute;top:30px;right:20px}.custom-dropdown[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer}.custom-dropdown[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]{position:absolute;width:100%;left:0;top:100%;background:#fff;border-radius:7px;box-shadow:0 5px 15px 0 rgba(144,147,151,.2);display:none;z-index:1}.custom-dropdown[_ngcontent-%COMP%]   .options.show[_ngcontent-%COMP%]{display:block}.custom-dropdown[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.custom-dropdown[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{cursor:pointer;padding:10px}.custom-dropdown[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background:#ccc}.all-center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}button[_ngcontent-%COMP%]:focus{border-color:none;box-shadow:none;outline:0 none}.add-category[_ngcontent-%COMP%]{padding:5% 0}@media only screen and (max-width:600px){.add-category[_ngcontent-%COMP%]{padding:8% 0}}.add-category[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#000;font-weight:600;font-size:25px;letter-spacing:.1px}.add-category[_ngcontent-%COMP%]   .add-img[_ngcontent-%COMP%]{text-align:center;cursor:pointer;margin-top:5%}@media only screen and (max-width:768px){.add-category[_ngcontent-%COMP%]   .add-img[_ngcontent-%COMP%]{margin-top:10%}}.add-category[_ngcontent-%COMP%]   .add-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;height:120px;object-fit:cover;object-position:center;box-shadow:0 0 10px #e7e7e7;border-radius:25px}@media only screen and (max-width:768px){.add-category[_ngcontent-%COMP%]   .add-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:150px;height:150px}}.add-category[_ngcontent-%COMP%]   .add-btn[_ngcontent-%COMP%]{text-align:center}@media only screen and (max-width:600px){.add-category[_ngcontent-%COMP%]   .plain-card[_ngcontent-%COMP%]{margin-top:20px}}']}),t})()}]}];let Mp=(()=>{class t{}return t.\u0275mod=s.Gb({type:t}),t.\u0275inj=s.Fb({factory:function(e){return new(e||t)},imports:[[o.d.forChild(jp)],o.d]}),t})(),Rp=(()=>{class t{}return t.\u0275mod=s.Gb({type:t}),t.\u0275inj=s.Fb({factory:function(e){return new(e||t)},imports:[[r.b,Mp,i.g,i.l]]}),t})()}}]);